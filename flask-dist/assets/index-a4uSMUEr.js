import{B as e,i as t,k as n,q as i,m as s,t as o,T as r,U as a}from"./AppContent-DzAY2IDB.js";import{R as d,P as c,r as l}from"./index-CCsViYEm.js";import{a as p}from"./pick-CcpBOeoj.js";import{a as h}from"./index-BI5xKCkj.js";import{I as m}from"./index-Cip1nc55.js";const u={PREFIX:`${e}-collapse`};class g extends t{constructor(e){super(Object.assign({},e))}initActiveKey(){const{defaultActiveKey:e,activeKey:t,accordion:n}=this.getProps();let i=t||e;return n&&(i=Array.isArray(i)?i[0]:i),i&&i.length?(i=Array.isArray(i)?i:[i],i):[]}handleChange(e,t){const{activeKey:n,accordion:i}=this.getProps(),{activeSet:s}=this.getStates();let o=new Set(s);o.has(e)?o.delete(e):i?o=new Set([e]):o.add(e),this._adapter.handleChange([...o.values()],t),void 0===n&&this._adapter.addActiveKey(o)}}class f extends t{constructor(e){super(Object.assign({},e)),this.updateDOMInRenderTree=e=>{this._adapter.setDOMInRenderTree(e)},this.updateDOMHeight=e=>{this._adapter.setDOMHeight(e)},this.updateVisible=e=>{this._adapter.setVisible(e)},this.updateIsTransitioning=e=>{this._adapter.setIsTransitioning(e)}}}const y=`${e}-collapsible`;class b extends n{constructor(e){super(e),this.domRef=d.createRef(),this.hasBeenRendered=!1,this.handleResize=e=>{const t=e[0];if(t){const e=b.getEntryInfo(t);this.foundation.updateDOMHeight(e.height),this.foundation.updateDOMInRenderTree(e.isShown)}},this.isChildrenInRenderTree=()=>!!this.domRef.current&&this.domRef.current.offsetHeight>0,this.state={domInRenderTree:!1,domHeight:0,visible:this.props.isOpen,isTransitioning:!1},this.foundation=new f(this.adapter)}get adapter(){return Object.assign(Object.assign({},super.adapter),{setDOMInRenderTree:e=>{this.state.domInRenderTree!==e&&this.setState({domInRenderTree:e})},setDOMHeight:e=>{this.state.domHeight!==e&&this.setState({domHeight:e})},setVisible:e=>{this.state.visible!==e&&this.setState({visible:e})},setIsTransitioning:e=>{this.state.isTransitioning!==e&&this.setState({isTransitioning:e})}})}componentDidMount(){super.componentDidMount(),this.resizeObserver=new ResizeObserver(this.handleResize),this.resizeObserver.observe(this.domRef.current);const e=this.isChildrenInRenderTree();this.foundation.updateDOMInRenderTree(e),e&&this.foundation.updateDOMHeight(this.domRef.current.scrollHeight)}componentDidUpdate(e,t,n){const s=Object.keys(p(this.props,["reCalcKey","isOpen"])).filter((t=>!i(this.props[t],e[t]))),o=Object.keys(p(this.state,["domInRenderTree"])).filter((e=>!i(this.state[e],t[e])));s.includes("reCalcKey")&&this.foundation.updateDOMHeight(this.domRef.current.scrollHeight),o.includes("domInRenderTree")&&this.state.domInRenderTree&&this.foundation.updateDOMHeight(this.domRef.current.scrollHeight),s.includes("isOpen")&&(!this.props.isOpen&&this.props.motion||this.foundation.updateVisible(this.props.isOpen)),this.props.motion&&e.isOpen!==this.props.isOpen&&this.foundation.updateIsTransitioning(!0)}componentWillUnmount(){super.componentWillUnmount(),this.resizeObserver.disconnect()}render(){const e=Object.assign({overflow:"hidden",height:this.props.isOpen?this.state.domHeight:this.props.collapseHeight,opacity:this.props.isOpen||!this.props.fade||0!==this.props.collapseHeight?1:0,transitionDuration:`${this.props.motion&&this.state.isTransitioning?this.props.duration:0}ms`},this.props.style),t=s(`${y}-wrapper`,{[`${y}-transition`]:this.props.motion&&this.state.isTransitioning},this.props.className),n=this.props.keepDOM&&(!this.props.lazyRender||this.hasBeenRendered)||0!==this.props.collapseHeight||this.state.visible||this.props.isOpen;return n&&!this.hasBeenRendered&&(this.hasBeenRendered=!0),d.createElement("div",Object.assign({className:t,style:e,onTransitionEnd:()=>{var e,t;this.props.isOpen||this.foundation.updateVisible(!1),this.foundation.updateIsTransitioning(!1),null===(t=(e=this.props).onMotionEnd)||void 0===t||t.call(e)}},this.getDataAttr(this.props)),d.createElement("div",{"x-semi-prop":"children",ref:this.domRef,style:{overflow:"hidden"},id:this.props.id},n&&this.props.children))}}b.__SemiComponentName__="Collapsible",b.defaultProps=o(b.__SemiComponentName__,{isOpen:!1,duration:250,motion:!0,keepDOM:!1,lazyRender:!1,collapseHeight:0,fade:!1}),b.getEntryInfo=e=>{let t;t=e.borderBoxSize?!(0===e.borderBoxSize[0].blockSize&&0===e.borderBoxSize[0].inlineSize):!(0===e.contentRect.height&&0===e.contentRect.width);let n=0;if(e.borderBoxSize)n=Math.ceil(e.borderBoxSize[0].blockSize);else{n=e.target.clientHeight}return{isShown:t,height:n}},b.propTypes={motion:c.bool,children:c.node,isOpen:c.bool,duration:c.number,keepDOM:c.bool,collapseHeight:c.number,style:c.object,className:c.string,reCalcKey:c.oneOfType([c.string,c.number])};const O=d.createContext({});class v extends l.PureComponent{constructor(){super(...arguments),this.headerExpandIconTriggerRef=d.createRef(),this.ariaID="",this.handleClick=(e,t)=>{var n;(this.context.clickHeaderToExpand||(null===(n=this.headerExpandIconTriggerRef.current)||void 0===n?void 0:n.contains(t.target)))&&this.context.onClick(e,t)}}componentDidMount(){this.ariaID=r({})}renderHeader(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{showArrow:n,header:i,extra:o}=this.props;let{expandIcon:r,collapseIcon:a}=this.context;const{expandIconPosition:c}=this.context;void 0===r&&(r=d.createElement(h,null)),void 0===a&&(a=d.createElement(m,null));const l=d.createElement("span",{ref:this.headerExpandIconTriggerRef,"aria-hidden":"true",className:s([`${u.PREFIX}-header-icon`,{[`${u.PREFIX}-header-iconDisabled`]:!t}])},t&&e?a:r),p="left"===c;return"string"==typeof i?d.createElement(d.Fragment,null,n&&(p?l:null),d.createElement("span",null,i),d.createElement("span",{className:`${u.PREFIX}-header-right`},d.createElement("span",null,o),n&&(p?null:l))):d.createElement(d.Fragment,null,n&&(p?l:null),i,n&&(p?null:l))}render(){const e=this.props,{className:t,children:n,itemKey:i,reCalcKey:o,header:r,extra:a,showArrow:c,disabled:l}=e,p=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}(e,["className","children","itemKey","reCalcKey","header","extra","showArrow","disabled"]),{keepDOM:h,expandIconPosition:m,activeSet:g,motion:f,lazyRender:y}=this.context,O=g.has(i),v=s(t,{[`${u.PREFIX}-item`]:!0}),I=s({[`${u.PREFIX}-header`]:!0,[`${u.PREFIX}-header-disabled`]:l,[`${u.PREFIX}-header-iconLeft`]:"left"===m}),R=s({[`${u.PREFIX}-content`]:!0});return d.createElement("div",Object.assign({className:v},p),d.createElement("div",{role:"button",tabIndex:0,className:I,"aria-disabled":l,"aria-expanded":O?"true":"false","aria-owns":this.ariaID,onClick:e=>!l&&this.handleClick(i,e)},this.renderHeader(O,void 0!==n&&!l)),n&&d.createElement(b,{lazyRender:y,isOpen:O,keepDOM:h,motion:f,onMotionEnd:this.props.onMotionEnd,reCalcKey:o},d.createElement("div",{className:R,"aria-hidden":!O,id:this.ariaID},d.createElement("div",{className:`${u.PREFIX}-content-wrapper`},n))))}}v.contextType=O,v.propTypes={itemKey:c.string,extra:c.node,header:c.oneOfType([c.string,c.node]),className:c.string,reCalcKey:c.oneOfType([c.string,c.number]),showArrow:c.bool,disabled:c.bool},v.defaultProps={showArrow:!0,disabled:!1};class I extends n{constructor(e){super(e),this.onChange=(e,t)=>{this.foundation.handleChange(e,t)},this.foundation=new g(this.adapter);const t=this.foundation.initActiveKey();this.state={activeSet:new Set(t)},this.onChange=this.onChange.bind(this)}get adapter(){return Object.assign(Object.assign({},super.adapter),{handleChange:(e,t)=>this.props.onChange(e,t),addActiveKey:e=>this.setState({activeSet:e})})}static getDerivedStateFromProps(e,t){if(e.activeKey){const n=Array.isArray(e.activeKey)?e.activeKey:[e.activeKey],s=new Set(n);return i(s,t.activeSet)?t:Object.assign(Object.assign({},t),{activeSet:s})}return t}componentWillUnmount(){this.foundation.destroy()}render(){const e=this.props,{defaultActiveKey:t,lazyRender:n,accordion:i,style:o,motion:r,className:a,keepDOM:c,expandIconPosition:l,expandIcon:p,collapseIcon:h,children:m,clickHeaderToExpand:g}=e;!function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}}(e,["defaultActiveKey","lazyRender","accordion","style","motion","className","keepDOM","expandIconPosition","expandIcon","collapseIcon","children","clickHeaderToExpand"]);const f=s(u.PREFIX,a),{activeSet:y}=this.state;return d.createElement("div",Object.assign({className:f,style:o},this.getDataAttr(this.props)),d.createElement(O.Provider,{value:{activeSet:y,expandIcon:p,collapseIcon:h,clickHeaderToExpand:g,keepDOM:c,expandIconPosition:l,onClick:this.onChange,motion:r,lazyRender:n}},m))}}I.Panel=v,I.propTypes={activeKey:c.oneOfType([c.string,c.array]),defaultActiveKey:c.oneOfType([c.string,c.array]),accordion:c.bool,clickHeaderToExpand:c.bool,onChange:c.func,expandIcon:c.node,collapseIcon:c.node,style:c.object,className:c.string,keepDOM:c.bool,motion:c.oneOfType([c.bool,c.func,c.object]),expandIconPosition:c.oneOf(["left","right"]),lazyRender:c.bool},I.__SemiComponentName__="Collapse",I.defaultProps=o(I.__SemiComponentName__,{defaultActiveKey:"",clickHeaderToExpand:!0,onChange:a,expandIconPosition:"right",lazyRender:!1});export{b as C,I as a};
