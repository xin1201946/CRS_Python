import{R as e,z as t,r as i,B as s,e as a,ai as r,f as n,a8 as l,c as o,d as c,P as d,_ as p,F as h,A as u,o as f,p as g,m,v as y}from"./index-clQ5-bGK.js";import{B as L}from"./index-CEYVhp-7.js";import{T as v,B as _,L as E,a as b}from"./pick-Bx703jyM.js";import{C as I}from"./index-paqEqfTo.js";import{D as S}from"./index-0_nFwdGB.js";import{S as F,T as A}from"./index-CKORjjze.js";import{S as P}from"./index-BEj57i6O.js";import{i as T}from"./isPromise-Bw3YL3VT.js";import{V as w,I as C}from"./IconClear-Cv6-CgeK.js";import{P as R}from"./index-BWMbquu9.js";import{I as x}from"./IconFile-VkMuXKfw.js";import{u as O}from"./AppContent-D7EGDpni.js";import{I as U}from"./IconPlus-DUoaNV9p.js";import"./isPlainObject-DbkhL0WE.js";const D=t((function(e){return i.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.5 12a7.5 7.5 0 0 1 13.8-4.07l-2-.4a1.5 1.5 0 0 0-.6 2.94l5 1c.76.15 1.51-.3 1.74-1.04l1.5-5a1.5 1.5 0 1 0-2.88-.86l-.43 1.45A10.49 10.49 0 0 0 1.5 12a10.5 10.5 0 0 0 20.4 3.5 1.5 1.5 0 1 0-2.83-1A7.5 7.5 0 0 1 4.5 12Z",fill:"currentColor"}))}),"refresh");const $=t((function(e){return i.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.84 8.06A6.5 6.5 0 1 0 5.18 11 4.5 4.5 0 0 0 5.5 20H17a6 6 0 0 0 .84-11.94Zm-5.52.2a.5.5 0 0 0-.64 0l-5.15 4.3a.25.25 0 0 0 .16.44H10v4.5c0 .28.22.5.5.5h3a.5.5 0 0 0 .5-.5V13h3.31c.23 0 .34-.3.16-.44l-5.15-4.3Z",fill:"currentColor"}))}),"upload"),j="picture",k="list",N={PREFIX:`${s}-upload`},z="auto",M={FILE_STATUS_UPLOADING:"uploading",FILE_STATUS_SUCCESS:"success",FILE_STATUS_UPLOAD_FAIL:"uploadFail",FILE_STATUS_VALIDATING:"validating",FILE_STATUS_VALID_FAIL:"validateFail",FILE_STATUS_WAIT_UPLOAD:"wait",FILE_LIST_PIC:j,FILE_LIST_DEFAULT:k,LIST_TYPE:[j,k],DRAG_AREA_DEFAULT:"default",DRAG_AREA_LEGAL:"legal",DRAG_AREA_ILLEGAL:"illegal",TRIGGER_AUTO:z,UPLOAD_TRIGGER:[z,"custom"],VALIDATE_STATUS:w,PROMPT_POSITION:["left","right","bottom"]},G=.95;var H=function(e,t,i,s){return new(i||(i=Promise))((function(a,r){function n(e){try{o(s.next(e))}catch(t){r(t)}}function l(e){try{o(s.throw(e))}catch(t){r(t)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,l)}o((s=s.apply(e,t||[])).next())}))};const B=1024,V=1048576;function W(e){return e<B?`${(e/B).toFixed(2)}KB`:e>=B&&e<V?`${(e/B).toFixed(1)}KB`:e>=V?`${(e/V).toFixed(1)}MB`:void 0}function q(e){return H(this,void 0,void 0,(function*(){const t=[],i=(e,s)=>H(this,void 0,void 0,(function*(){if(s=s||"",e.path=s,e.isFile)t.push(new Promise(((t,i)=>{e.file((i=>{e.fullPath&&!i.webkitRelativePath&&(Object.defineProperties(i,{webkitRelativePath:{writable:!0}}),i.webkitRelativePath=e.fullPath.replace(/^\//,""),Object.defineProperties(i,{webkitRelativePath:{writable:!1}})),t(i)}),i)})));else if(e.isDirectory){const t=yield function(e){return H(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const s=e.createReader();let a=[];!function e(){s.readEntries((i=>{const s=Array.prototype.slice.apply(i);a=a.concat(s),s.length?e():t(a)}),i)}()}))}))}(e);for(let a=0;a<t.length;a++){const r=t[a];yield i(r,`${s}${e.name}/`)}}}));try{const s=e.map((e=>i(e.webkitGetAsEntry())));yield Promise.all(s);return yield Promise.all(t)}catch(s){return[]}}))}var K=function(e,t,i,s){return new(i||(i=Promise))((function(a,r){function n(e){try{o(s.next(e))}catch(t){r(t)}}function l(e){try{o(s.throw(e))}catch(t){r(t)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,l)}o((s=s.apply(e,t||[])).next())}))};const{FILE_STATUS_UPLOADING:Z,FILE_STATUS_SUCCESS:X,FILE_STATUS_UPLOAD_FAIL:Y,FILE_STATUS_VALID_FAIL:J,FILE_STATUS_WAIT_UPLOAD:Q,DRAG_AREA_DEFAULT:ee,DRAG_AREA_LEGAL:te,TRIGGER_AUTO:ie}=M;class se extends a{constructor(e){super(Object.assign({},e)),this.destroyState=!1}init(){this.destroyState=!1;const{disabled:e,addOnPasting:t}=this.getProps();t&&!e&&this.bindPastingHandler()}destroy(){const{disabled:e,addOnPasting:t}=this.getProps();this.releaseMemory(),e||this.unbindPastingHandler(),this.destroyState=!0}getError(e){let{action:t,xhr:i,message:s,fileName:a}=e;const r=i?i.status:0,n=new Error(s||`cannot post ${a} to ${t}, xhr status: ${r}'`);return n.status=r,n.method="post",n.url=t,n}getBody(e){if(!e)return;const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(i){return t}}checkFileSize(e){const{size:t}=e,{maxSize:i,minSize:s}=this.getProps();let a=!1;return(t>i*B||t<s*B)&&(a=!0),a}handleChange(e){const t=[],{limit:i,transformFile:s,accept:a}=this.getProps(),{fileList:n}=this.getStates();let l=Array.from(e);if(void 0!==a&&(l=l.filter((e=>{const i=this.checkFileFormat(a,e);return i||t.push(e),i})),0!==t.length&&this._adapter.notifyAcceptInvalid(t),0===l.length))return;l=l.map((e=>(s&&(e=s(e)),e.uid||(e.uid=r()),this.checkFileSize(e)&&(e._sizeInvalid=!0,e.status=J,this._adapter.notifySizeError(e,n)),e)));const o=n.length+l.length;if(void 0!==i&&o>i){if(this._adapter.notifyExceed(l),1===i)return l=l.slice(-1),this._adapter.notifyFileSelect(l),this._adapter.resetInput(),void this.replaceFileList(l);const e=i-n.length;l=l.slice(0,e)}this._adapter.notifyFileSelect(l),this._adapter.resetInput(),this.addFilesToList(l)}handleReplaceChange(e){if(0===e.length)return;const{transformFile:t,uploadTrigger:i,accept:s}=this.getProps(),{replaceIdx:a,fileList:n}=this.getStates();let l=Array.from(e).pop();if(void 0!==s&&!this.checkFileFormat(s,l))return void this._adapter.notifyAcceptInvalid([l]);t&&(l=t(l)),l.uid||(l.uid=r()),this.checkFileSize(l)&&(l._sizeInvalid=!0,l.status=J,this._adapter.notifySizeError(l,n)),this._adapter.notifyFileSelect([l]);const o=this.buildFileItem(l,i),c=[...n];c.splice(a,1,o),this._adapter.notifyChange({currentFile:o,fileList:c}),this._adapter.updateFileList(c,(()=>{this._adapter.resetReplaceInput(),o._sizeInvalid||this.upload(o)}))}buildFileItem(e,t){const{_sizeInvalid:i,status:s}=e;try{delete e._sizeInvalid,delete e.status}catch(r){}const a={status:s||(t===ie?Z:Q),name:e.name,size:W(e.size),uid:e.uid,percent:0,fileInstance:e,url:this._createURL(e)};return i&&(a._sizeInvalid=!0),this.isImage(e)&&(a.preview=!0),a}replaceFileList(e){const{uploadTrigger:t}=this.getProps(),i=e.map((e=>this.buildFileItem(e,t)));this._adapter.notifyChange({fileList:i,currentFile:i[0]}),this._adapter.updateFileList(i,(()=>{t===ie&&this.startUpload(i)}))}addFilesToList(e){const t=this.getState("fileList").slice(),{uploadTrigger:i}=this.getProps(),s=e.map((e=>this.buildFileItem(e,i)));s.forEach((e=>{const i=t.findIndex((t=>t.uid===e.uid));-1!==i?t[i]=e:(t.push(e),this._adapter.notifyChange({fileList:t,currentFile:e}))})),this._adapter.updateFileList(t,(()=>{i===ie&&this.startUpload(s)}))}insertFileToList(e,t){const{limit:i,transformFile:s,accept:a,uploadTrigger:n}=this.getProps(),{fileList:l}=this.getStates(),o=[];let c=Array.from(e);if(void 0!==a&&(c=c.filter((e=>{const t=this.checkFileFormat(a,e);return t||o.push(e),t})),0!==o.length&&this._adapter.notifyAcceptInvalid(o),0===c.length))return;c=c.map((e=>(e.uid||(e.uid=r()),this.checkFileSize(e)&&(e._sizeInvalid=!0,e.status=J,this._adapter.notifySizeError(e,l)),s&&(e=s(e)),e)));const d=l.length+c.length;if(void 0!==i&&d>i){if(1===i)return c=c.slice(-1),this._adapter.notifyFileSelect(c),this._adapter.resetInput(),void this.replaceFileList(c);const e=i-l.length;c=c.slice(0,e),this._adapter.notifyExceed(c)}const p=c.map((e=>this.buildFileItem(e,n))),h=l.slice();void 0!==t?h.splice(t,0,...p):h.push(...p),this._adapter.notifyFileSelect(c),this._adapter.notifyChange({fileList:h,currentFile:null}),this._adapter.updateFileList(h,(()=>{n===ie&&this.startUpload(p)}))}manualUpload(){const e=this.getState("fileList").filter((e=>e.status===Q));this.startUpload(e)}startUpload(e){e.forEach((e=>{e._sizeInvalid||this.upload(e)}))}upload(e){const{beforeUpload:t}=this.getProps();if(void 0!==t){if("function"==typeof t){const{fileList:t}=this.getStates(),i=this._adapter.notifyBeforeUpload({file:e,fileList:t});switch(!0){case!0===i:this.post(e);break;case!1===i:{const t={shouldUpload:!1,status:M.FILE_STATUS_VALID_FAIL};this.handleBeforeUploadResultInObject(t,e);break}case i&&T(i):Promise.resolve(i).then((t=>{let i={shouldUpload:!0};"Object"===Object.prototype.toString.call(t).slice(8,-1)&&(i=Object.assign(Object.assign({},i),t)),this.handleBeforeUploadResultInObject(i,e)}),(t=>{let i={shouldUpload:!1,status:M.FILE_STATUS_VALID_FAIL};"Object"===Object.prototype.toString.call(t).slice(8,-1)&&(i=Object.assign(Object.assign({},i),t)),this.handleBeforeUploadResultInObject(i,e)}));break;case"object"==typeof i:this.handleBeforeUploadResultInObject(i,e)}}}else this.post(e)}handleBeforeUploadResultInObject(e,t){const{shouldUpload:i,status:s,autoRemove:a,validateMessage:r,fileInstance:n}=e;let l=this.getState("fileList").slice();if(a)l=l.filter((e=>e.uid!==t.uid));else{const e=this._getFileIndex(t,l);if(e<0)return;s&&(l[e].status=s),r&&(l[e].validateMessage=r),n&&(n.uid=t.uid,l[e].fileInstance=n,l[e].size=W(n.size),l[e].name=n.name,l[e].url=this._createURL(n)),l[e].shouldUpload=i}this._adapter.updateFileList(l),this._adapter.notifyChange({fileList:l,currentFile:t}),i&&this.post(t)}post(e){const{fileInstance:t}=e,i=this.getProps();if("undefined"==typeof XMLHttpRequest)return;const s=new XMLHttpRequest,a=new FormData,{action:r}=i;let{data:n}=i;n&&("function"==typeof n&&(n=n(t)),Object.keys(n).forEach((e=>{a.append(e,n[e])})));const l=i.name||i.fileName||t.name;if(i.customRequest)return i.customRequest({fileName:l,data:n,file:e,fileInstance:t,onProgress:e=>this.handleProgress({e:e,fileInstance:t}),onError:(e,i)=>this.handleError({e:i,xhr:e,fileInstance:t}),onSuccess:(e,i)=>this.handleSuccess({response:e,fileInstance:t,e:i,isCustomRequest:!0}),withCredentials:i.withCredentials,action:i.action});a.append(l,t),s.open("post",r,!0),i.withCredentials&&"withCredentials"in s&&(s.withCredentials=!0),s.upload&&(s.upload.onprogress=e=>{this.destroyState?s.abort():this.handleProgress({e:e,fileInstance:t})}),s.onload=e=>{this.destroyState||this.handleOnLoad({e:e,xhr:s,fileInstance:t})},s.onerror=e=>{this.destroyState||this.handleError({e:e,xhr:s,fileInstance:t})};let o=i.headers||{};"function"==typeof o&&(o=o(t));for(const c in o)Object.prototype.hasOwnProperty.call(o,c)&&null!==o[c]&&s.setRequestHeader(c,o[c]);s.send(a)}handleProgress(e){let{e:t,fileInstance:i}=e;const{fileList:s}=this.getStates(),a=s.slice();let r=0;t.total>0&&(r=Number((t.loaded/t.total*100*G).toFixed(0))||0);const n=this._getFileIndex(i,a);n<0||(a[n].percent=r,a[n].status=Z,this._adapter.notifyProgress(r,i,a),this._adapter.updateFileList(a),this._adapter.notifyChange({fileList:a,currentFile:a[n]}))}handleOnLoad(e){let{e:t,xhr:i,fileInstance:s}=e;const{fileList:a}=this.getStates(),r=this._getFileIndex(s,a);r<0||(i.status<200||i.status>=300?this.handleError({e:t,xhr:i,fileInstance:s}):this.handleSuccess({e:t,xhr:i,fileInstance:s,index:r}))}handleSuccess(e){let{e:t,fileInstance:i,isCustomRequest:s=!1,xhr:a,response:r}=e;const{fileList:n}=this.getStates();let l=null;const o=this._getFileIndex(i,n);if(o<0)return;l=s?r:this.getBody(a);const c=n.slice(),{afterUpload:d}=this.getProps();if(c[o].status=X,c[o].percent=100,this._adapter.notifyProgress(100,i,c),c[o].response=l,t&&(c[o].event=t),d&&"function"==typeof d){const{autoRemove:e,status:t,validateMessage:i,name:s,url:a}=this._adapter.notifyAfterUpload({response:l,file:c[o],fileList:c})||{};t&&(c[o].status=t),i&&(c[o].validateMessage=i),s&&(c[o].name=s),a&&(c[o].url=a),e&&c.splice(o,1)}this._adapter.notifySuccess(l,i,c),this._adapter.notifyChange({fileList:c,currentFile:c[o]}),this._adapter.updateFileList(c)}_getFileIndex(e,t){return t.findIndex((t=>t.uid===e.uid))}handleRemove(e){const{disabled:t}=this.getProps();if(t)return;const{fileList:i}=this.getStates();Promise.resolve(this._adapter.notifyBeforeRemove(e,i)).then((t=>{if(!1===t)return;const s=i.slice(),a=this._getFileIndex(e,i);a<0||(s.splice(a,1),this._adapter.notifyRemove(e.fileInstance,s,e),this._adapter.updateFileList(s),this._adapter.notifyChange({fileList:s,currentFile:e}))}))}handleError(e){let{e:t,xhr:i,fileInstance:s}=e;const{fileList:a}=this.getStates(),r=this._getFileIndex(s,a);if(r<0)return;const{action:n}=this.getProps(),l=a.slice(),o=this.getError({action:n,xhr:i,fileName:s.name});l[r].status=Y,l[r].response=o,l[r].event=t,this._adapter.notifyError(o,s,l,i),this._adapter.updateFileList(l),this._adapter.notifyChange({currentFile:l[r],fileList:l})}handleClear(){const{disabled:e}=this.getProps(),{fileList:t}=this.getStates();e||Promise.resolve(this._adapter.notifyBeforeClear(t)).then((e=>{!1!==e&&(this._adapter.updateFileList([]),this._adapter.notifyClear(),this._adapter.notifyChange({fileList:[]}))})).catch((e=>{}))}_createURL(e){const t=URL.createObjectURL(e),{localUrls:i}=this.getStates(),s=i.slice();return s.push(t),this._adapter.updateLocalUrls(s),t}releaseMemory(){const{localUrls:e}=this.getStates();e.forEach((e=>{this._releaseBlob(e)}))}_releaseBlob(e){try{URL.revokeObjectURL(e)}catch(t){}}isImage(e){return/(webp|svg|png|gif|jpg|jpeg|bmp|dpg)$/i.test(e.type)}isMultiple(){return Boolean(this.getProp("multiple"))}handleDragEnter(e){e.preventDefault(),e.stopPropagation(),this._dragEnterTarget=e.currentTarget;const{disabled:t}=this.getProps();t||this._adapter.updateDragAreaStatus(te)}handleDirectoryDrop(e){return K(this,void 0,void 0,(function*(){const t=this.getState("fileList").slice(),i=[].slice.call(e.dataTransfer.items),s=yield q(i);this.handleChange(s),this._adapter.updateDragAreaStatus(ee),this._adapter.notifyDrop(e,s,t)}))}handleDrop(e){e.preventDefault(),e.stopPropagation();const{disabled:t,directory:i}=this.getProps(),s=this.getState("fileList").slice();if(!t){if(i)return void this.handleDirectoryDrop(e);const t=Array.from(e.dataTransfer.files);this.handleChange(t),this._adapter.updateDragAreaStatus(ee),this._adapter.notifyDrop(e,t,s)}}handleDragOver(e){e.preventDefault(),e.stopPropagation()}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),this._dragEnterTarget===e.target&&this._adapter.updateDragAreaStatus(ee)}checkFileFormat(e,t){const i=e.split(",").map((e=>e.trim())).filter((e=>e)),s=t.type||"",a=s.replace(/\/.*$/,"");return i.some((e=>{if("."===e.charAt(0)){const s=t.name||"",a=e.split(".").pop().toLowerCase();return i=s.toLowerCase(),r=a,-1!==i.indexOf(r,i.length-r.length)}var i,r;if(/\/\*$/.test(e)){const t=e.replace(/\/.*$/,"");return a===t}return!!/^[^\/]+\/[^\/]+$/.test(e)&&s===e}))}retry(e){const{onRetry:t}=this.getProps();t&&"function"==typeof t&&t(e),this.post(e)}handlePreviewClick(e){this._adapter.notifyPreviewClick(e)}readFileFromClipboard(e){for(const t of e)for(const e of t.types)e.startsWith("image")&&t.getType(e).then((e=>e.arrayBuffer())).then((t=>{const i=e.split("/")[1],s=new File([t],`upload.${i}`,{type:e});this.handleChange([s])}))}handlePasting(e){const t=this._adapter.isMac()?e.metaKey:e.ctrlKey,{addOnPasting:i}=this.getProps();if(i&&t&&"KeyV"===e.code){const e="clipboard-read";navigator.permissions.query({name:e}).then((e=>{"granted"===e.state||"prompt"===e.state?navigator.clipboard.read().then((e=>{this.readFileFromClipboard(e)})):this._adapter.notifyPastingError(e)})).catch((e=>{this._adapter.notifyPastingError(e)}))}}bindPastingHandler(){this._adapter.registerPastingHandler((e=>this.handlePasting(e)))}unbindPastingHandler(){this._adapter.unRegisterPastingHandler()}}class ae extends a{constructor(e){super(Object.assign({},e))}handleImageError(e){this._adapter.updateFallbackPreview(!0)}}const re=N.PREFIX,ne=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.createElement("svg",Object.assign({focusable:!1,"aria-hidden":!0,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("circle",{cx:"7.99992",cy:"7.99992",r:"6.66667",fill:"white"}),e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.3332 8.00008C15.3332 12.0502 12.0499 15.3334 7.99984 15.3334C3.94975 15.3334 0.666504 12.0502 0.666504 8.00008C0.666504 3.94999 3.94975 0.666748 7.99984 0.666748C12.0499 0.666748 15.3332 3.94999 15.3332 8.00008ZM8.99984 11.6667C8.99984 11.1145 8.55212 10.6667 7.99984 10.6667C7.44755 10.6667 6.99984 11.1145 6.99984 11.6667C6.99984 12.219 7.44755 12.6667 7.99984 12.6667C8.55212 12.6667 8.99984 12.219 8.99984 11.6667ZM7.99984 3.33341C7.27573 3.33341 6.7003 3.94171 6.74046 4.66469L6.94437 8.33495C6.97549 8.89513 7.4388 9.33341 7.99984 9.33341C8.56087 9.33341 9.02419 8.89513 9.05531 8.33495L9.25921 4.66469C9.29938 3.94171 8.72394 3.33341 7.99984 3.33341Z",fill:"#F93920"}))},le=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.createElement("svg",Object.assign({focusable:!1,"aria-hidden":!0,width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("circle",{cx:"14",cy:"14",r:"14",fill:"#16161A",fillOpacity:"0.6"}),e.createElement("path",{d:"M9 10.25V18.25L10.25 13.25H17.875V11.75C17.875 11.4739 17.6511 11.25 17.375 11.25H14L12.75 9.75H9.5C9.22386 9.75 9 9.97386 9 10.25Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),e.createElement("path",{d:"M18 18.25L19 13.25H10.2031L9 18.25H18Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},oe=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.createElement("svg",Object.assign({focusable:!1,"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("path",{d:"M6 17V7.58824C6 7.26336 6.26863 7 6.6 7H10.5L12 8.76471H16.05C16.3814 8.76471 16.65 9.02806 16.65 9.35294V11.1176H7.5L6 17ZM6 17L7.44375 11.1176H18L16.8 17L6 17Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}))};class ce extends n{constructor(e){super(e),this.state={fallbackPreview:!1},this.foundation=new ae(this.adapter)}get adapter(){return Object.assign(Object.assign({},super.adapter),{updateFallbackPreview:e=>this.setState({fallbackPreview:e})})}transSize(e){return"number"==typeof e?W(e):e}renderValidateMessage(){const{status:t,validateMessage:i}=this.props;let s=null;switch(!0){case"string"==typeof i&&t===M.FILE_STATUS_VALIDATING:s=e.createElement(e.Fragment,null,e.createElement(P,{size:"small",wrapperClassName:`${re}-file-card-icon-loading`}),i);break;case"string"==typeof i:s=e.createElement(e.Fragment,null,e.createElement(l,{className:`${re}-file-card-icon-error`}),i);break;case a=i,e.isValidElement(a):s=i}var a;return s}renderPicValidateMsg(){const{status:t,validateMessage:i}=this.props;let s=null;switch(!0){case i&&t===M.FILE_STATUS_VALIDATING:s=e.createElement(P,{size:"small",wrapperClassName:`${re}-picture-file-card-icon-loading`});break;case i&&(t===M.FILE_STATUS_VALID_FAIL||t===M.FILE_STATUS_UPLOAD_FAIL):s=e.createElement("div",{className:`${re}-picture-file-card-icon-error`},e.createElement(ne,null))}return s?e.createElement(v,{content:i,trigger:"hover",position:"bottom"},s):null}renderPic(t){const{fallbackPreview:i}=this.state,{url:s,percent:a,status:r,disabled:n,style:l,onPreviewClick:c,showPicInfo:d,renderPicInfo:p,renderPicPreviewIcon:h,renderThumbnail:u,name:f,index:g,picHeight:m,picWidth:y}=this.props,L=r===M.FILE_STATUS_UPLOADING&&100!==a,_=r===M.FILE_STATUS_UPLOAD_FAIL&&this.props.showRetry,E=r===M.FILE_STATUS_SUCCESS&&this.props.showReplace,b=r===M.FILE_STATUS_SUCCESS&&!this.props.showReplace,I="function"==typeof u,S=o({[`${re}-picture-file-card`]:!0,[`${re}-picture-file-card-preview-fallback`]:i,[`${re}-picture-file-card-disabled`]:n,[`${re}-picture-file-card-show-pointer`]:void 0!==c,[`${re}-picture-file-card-error`]:r===M.FILE_STATUS_UPLOAD_FAIL,[`${re}-picture-file-card-uploading`]:L,[`${re}-picture-file-card-custom-thumbnail`]:I&&m&&y}),F=e.createElement("div",{role:"button",tabIndex:0,className:`${re}-picture-file-card-retry`,onClick:e=>this.onRetry(e)},e.createElement(D,{className:`${re}-picture-file-card-icon-retry`})),A=e.createElement(v,{trigger:"hover",position:"top",content:t.replace,showArrow:!1,spacing:4},e.createElement("div",{role:"button",tabIndex:0,className:`${re}-picture-file-card-replace`,onClick:e=>this.onReplace(e)},e.createElement(le,{className:`${re}-picture-file-card-icon-replace`}))),P=e.createElement("div",{className:`${re}-picture-file-card-preview`},"function"==typeof h?h(this.props):null),T=e.createElement("div",{role:"button",tabIndex:0,className:`${re}-picture-file-card-close`,onClick:e=>this.onRemove(e)},e.createElement(C,{className:`${re}-picture-file-card-icon-close`})),w="function"==typeof p?p(this.props):e.createElement("div",{className:`${re}-picture-file-card-pic-info`},g+1);let O={},U=l?Object.assign({},l):{};m&&(U.height=m,O.height=m),y&&(U.width=y,O.width=y);const $=i?e.createElement(x,{size:"large"}):e.createElement("img",{src:s,alt:f,onError:e=>this.foundation.handleImageError(e),style:O}),j=I?u(this.props):$;return e.createElement("div",{role:"listitem",className:S,style:U,onClick:c},j,L?e.createElement(R,{percent:a,type:"circle",size:"small",orbitStroke:"#FFF","aria-label":"uploading file progress"}):null,_?F:null,E&&A,b&&P,d&&w,!n&&T,this.renderPicValidateMsg())}renderFile(t){const{name:i,size:s,percent:a,url:r,showRetry:n,showReplace:l,preview:d,previewFile:p,status:h,style:u,onPreviewClick:f,renderFileOperation:g}=this.props,{fallbackPreview:m}=this.state,y=o({[`${re}-file-card`]:!0,[`${re}-file-card-fail`]:h===M.FILE_STATUS_VALID_FAIL||h===M.FILE_STATUS_UPLOAD_FAIL,[`${re}-file-card-show-pointer`]:void 0!==f}),L=o({[`${re}-file-card-preview`]:!0,[`${re}-file-card-preview-placeholder`]:!d||p||m}),E=`${re}-file-card-info`,b=`${re}-file-card-close`,I=`${re}-file-card-replace`,S=!(100===a||void 0===a)&&h===M.FILE_STATUS_UPLOADING,F=h===M.FILE_STATUS_UPLOAD_FAIL&&n,A=h===M.FILE_STATUS_SUCCESS&&l,P=this.transSize(s);let T=d&&!m?e.createElement("img",{src:r,alt:i,onError:e=>this.foundation.handleImageError(e)}):e.createElement(x,{size:"large"});p&&(T=p(this.props));const w="function"==typeof g?g(this.props):e.createElement(_,{onClick:e=>this.onRemove(e),type:"tertiary",icon:e.createElement(c,null),theme:"borderless",size:"small",className:b});return e.createElement("div",{role:"listitem",className:y,style:u,onClick:f},e.createElement("div",{className:L},T),e.createElement("div",{className:`${E}-main`},e.createElement("div",{className:`${E}-main-text`},e.createElement("span",{className:`${E}-name`},i),e.createElement("span",null,e.createElement("span",{className:`${E}-size`},P),A&&e.createElement(v,{trigger:"hover",position:"top",showArrow:!1,content:t.replace},e.createElement(_,{onClick:e=>this.onReplace(e),type:"tertiary",theme:"borderless",size:"small",icon:e.createElement(oe,null),className:I})))),S?e.createElement(R,{percent:a,style:{width:"100%"},"aria-label":"uploading file progress"}):null,e.createElement("div",{className:`${E}-main-control`},e.createElement("span",{className:`${E}-validate-message`},this.renderValidateMessage()),F?e.createElement("span",{role:"button",tabIndex:0,className:`${E}-retry`,onClick:e=>this.onRetry(e)},t.retry):null)),w)}onRemove(e){e.stopPropagation(),this.props.onRemove()}onReplace(e){e.stopPropagation(),this.props.onReplace()}onRetry(e){e.stopPropagation(),this.props.onRetry()}render(){const{listType:t}=this.props;return t===M.FILE_LIST_PIC?e.createElement(E,{componentName:"Upload"},(e=>this.renderPic(e))):t===M.FILE_LIST_DEFAULT?e.createElement(E,{componentName:"Upload"},(e=>this.renderFile(e))):null}}ce.propTypes={className:d.string,disabled:d.bool,listType:d.string,name:d.string,onPreviewClick:d.func,onRemove:d.func,onReplace:d.func,onRetry:d.func,percent:d.number,preview:d.bool,previewFile:d.func,picWidth:d.oneOfType([d.number,d.string]),picHeight:d.oneOfType([d.number,d.string]),showReplace:d.bool,showRetry:d.bool,size:d.oneOfType([d.number,d.string]),status:d.string,style:d.object,url:d.string,validateMessage:d.node,index:d.number},ce.defaultProps={listType:M.FILE_LIST_DEFAULT,name:"",onRemove:()=>{},onRetry:()=>{},preview:!1,size:""};const de=N.PREFIX;class pe extends n{constructor(t){super(t),this.inputRef=null,this.replaceInputRef=null,this.onClick=()=>{const{inputRef:e,props:t}=this,{onOpenFileDialog:i}=t;!Boolean(this.props.disabled)&&e&&e.current&&(e.current.click(),i&&i())},this.onChange=e=>{const{files:t}=e.target;this.foundation.handleChange(t)},this.replace=e=>{this.setState({replaceIdx:e},(()=>{this.replaceInputRef.current.click()}))},this.onReplaceChange=e=>{const{files:t}=e.target;this.foundation.handleReplaceChange(t)},this.clear=()=>{this.foundation.handleClear()},this.remove=e=>{this.foundation.handleRemove(e)},this.insert=(e,t)=>this.foundation.insertFileToList(e,t),this.upload=()=>{this.foundation.manualUpload()},this.openFileDialog=()=>{this.onClick()},this.renderFile=(t,i,s)=>{const{name:a,status:r,validateMessage:n,_sizeInvalid:l,uid:o}=t,{previewFile:c,listType:d,itemStyle:p,showPicInfo:h,renderPicInfo:u,renderPicPreviewIcon:f,renderFileOperation:g,renderFileItem:m,renderThumbnail:y,disabled:L,onPreviewClick:v,picWidth:_,picHeight:E}=this.props,I=Object.assign(Object.assign(Object.assign({},b(this.props,["showRetry","showReplace",""])),t),{previewFile:c,listType:d,onRemove:()=>this.remove(t),onRetry:()=>{this.foundation.retry(t)},index:i,key:o||`${a}${i}`,style:p,disabled:L,showPicInfo:h,renderPicInfo:u,renderPicPreviewIcon:f,renderFileOperation:g,renderThumbnail:y,onReplace:()=>{this.replace(i)},onPreviewClick:void 0!==v?()=>this.foundation.handlePreviewClick(t):void 0,picWidth:_,picHeight:E});return r!==M.FILE_STATUS_UPLOAD_FAIL||n||(I.validateMessage=s.fail),l&&!n&&(I.validateMessage=s.illegalSize),void 0===m?e.createElement(ce,Object.assign({},I)):m(I)},this.renderFileList=()=>{const{listType:e}=this.props;return e===M.FILE_LIST_PIC?this.renderFileListPic():e===M.FILE_LIST_DEFAULT?this.renderFileListDefault():null},this.renderFileListPic=()=>{const{showUploadList:t,limit:i,disabled:s,children:a,draggable:r,hotSpotLocation:n,picHeight:l,picWidth:c}=this.props,{fileList:d,dragAreaStatus:p}=this.state,h=this.props.fileList||d,u=!i||i>h.length,f=`${de}-drag-area`,g=o(`${de}-add`,{[`${de}-picture-add`]:!0,[`${de}-picture-add-disabled`]:s}),m=o(`${de}-file-list`,{[`${de}-picture-file-list`]:!0}),y=o({[`${f}-legal`]:p===M.DRAG_AREA_LEGAL,[`${f}-illegal`]:p===M.DRAG_AREA_ILLEGAL}),L=`${de}-file-list-main`,v={role:"button",className:g,onClick:this.onClick,style:{height:l,width:c}},_={className:m},b={onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnter:this.onDragEnter};r&&Object.assign(v,b,{className:o(g,y)});const I=e.createElement("div",Object.assign({},v,{"x-semi-prop":"children"}),a);return t&&h.length?e.createElement(E,{componentName:"Upload"},(t=>e.createElement("div",Object.assign({},_),e.createElement("div",{className:L,role:"list","aria-label":"picture list"},u&&"start"===n?I:null,h.map(((e,i)=>this.renderFile(e,i,t))),u&&"end"===n?I:null)))):u?I:null},this.renderFileListDefault=()=>{const{showUploadList:t,limit:i,disabled:s}=this.props,{fileList:a}=this.state,r=this.props.fileList||a,n=o(`${de}-file-list`),l=`${de}-file-list-title`,c=`${de}-file-list-main`,d=1!==i&&r.length,p=this.props.showClear&&!s,h={className:n};return t&&r.length?e.createElement(E,{componentName:"Upload"},(t=>e.createElement("div",Object.assign({},h),d?e.createElement("div",{className:l},e.createElement("span",{className:`${l}-choosen`},t.selectedFiles),p?e.createElement("span",{role:"button",tabIndex:0,onClick:this.clear,className:`${l}-clear`},t.clear):null):null,e.createElement("div",{className:c,role:"list","aria-label":"file list"},r.map(((e,i)=>this.renderFile(e,i,t))))))):null},this.onDrop=e=>{this.foundation.handleDrop(e)},this.onDragOver=e=>{this.foundation.handleDragOver(e)},this.onDragLeave=e=>{this.foundation.handleDragLeave(e)},this.onDragEnter=e=>{this.foundation.handleDragEnter(e)},this.renderAddContent=()=>{const{draggable:t,children:i,listType:s,disabled:a}=this.props,r=o(`${de}-add`);return s===M.FILE_LIST_PIC?null:t?this.renderDragArea():e.createElement("div",{role:"button",tabIndex:0,"aria-disabled":a,className:r,onClick:this.onClick},i)},this.renderDragArea=()=>{const{dragAreaStatus:t}=this.state,{children:i,dragIcon:s,dragMainText:a,dragSubText:r,disabled:n}=this.props,l=`${de}-drag-area`,c=o(l,{[`${l}-legal`]:t===M.DRAG_AREA_LEGAL,[`${l}-illegal`]:t===M.DRAG_AREA_ILLEGAL,[`${l}-custom`]:i});return e.createElement(E,{componentName:"Upload"},(o=>e.createElement("div",{role:"button",tabIndex:0,"aria-disabled":n,className:c,onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnter:this.onDragEnter,onClick:this.onClick},i||e.createElement(e.Fragment,null,e.createElement("div",{className:`${l}-icon`,"x-semi-prop":"dragIcon"},s||e.createElement($,{size:"extra-large"})),e.createElement("div",{className:`${l}-text`},e.createElement("div",{className:`${l}-main-text`,"x-semi-prop":"dragMainText"},a||o.mainText),e.createElement("div",{className:`${l}-sub-text`,"x-semi-prop":"dragSubText"},r),e.createElement("div",{className:`${l}-tips`},t===M.DRAG_AREA_LEGAL&&e.createElement("span",{className:`${l}-tips-legal`},o.legalTips),t===M.DRAG_AREA_ILLEGAL&&e.createElement("span",{className:`${l}-tips-illegal`},o.illegalTips)))))))},this.state={fileList:t.defaultFileList||[],replaceIdx:-1,inputKey:Math.random(),replaceInputKey:Math.random(),dragAreaStatus:"default",localUrls:[]},this.foundation=new se(this.adapter),this.inputRef=e.createRef(),this.replaceInputRef=e.createRef()}static getDerivedStateFromProps(e){const{fileList:t}=e;return"fileList"in e?{fileList:t||[]}:null}get adapter(){return Object.assign(Object.assign({},super.adapter),{notifyFileSelect:e=>this.props.onFileChange(e),notifyError:(e,t,i,s)=>this.props.onError(e,t,i,s),notifySuccess:(e,t,i)=>this.props.onSuccess(e,t,i),notifyProgress:(e,t,i)=>this.props.onProgress(e,t,i),notifyRemove:(e,t,i)=>this.props.onRemove(e,t,i),notifySizeError:(e,t)=>this.props.onSizeError(e,t),notifyExceed:e=>this.props.onExceed(e),updateFileList:(e,t)=>{"function"==typeof t?this.setState({fileList:e},t):this.setState({fileList:e})},notifyBeforeUpload:e=>{let{file:t,fileList:i}=e;return this.props.beforeUpload({file:t,fileList:i})},notifyAfterUpload:e=>{let{response:t,file:i,fileList:s}=e;return this.props.afterUpload({response:t,file:i,fileList:s})},resetInput:()=>{this.setState((e=>({inputKey:Math.random()})))},resetReplaceInput:()=>{this.setState((e=>({replaceInputKey:Math.random()})))},isMac:()=>navigator.platform.toUpperCase().indexOf("MAC")>=0,registerPastingHandler:e=>{document.body.addEventListener("keydown",e),this.pastingCb=e},unRegisterPastingHandler:()=>{this.pastingCb&&document.body.removeEventListener("keydown",this.pastingCb)},notifyPastingError:e=>this.props.onPastingError(e),updateDragAreaStatus:e=>this.setState({dragAreaStatus:e}),notifyChange:e=>{let{currentFile:t,fileList:i}=e;return this.props.onChange({currentFile:t,fileList:i})},updateLocalUrls:e=>this.setState({localUrls:e}),notifyClear:()=>this.props.onClear(),notifyPreviewClick:e=>this.props.onPreviewClick(e),notifyDrop:(e,t,i)=>this.props.onDrop(e,t,i),notifyAcceptInvalid:e=>this.props.onAcceptInvalid(e),notifyBeforeRemove:(e,t)=>this.props.beforeRemove(e,t),notifyBeforeClear:e=>this.props.beforeClear(e)})}componentDidMount(){this.foundation.init()}componentWillUnmount(){this.foundation.destroy()}render(){const t=this.props,{style:i,className:s,multiple:a,accept:r,disabled:n,children:l,capture:c,listType:d,prompt:p,promptPosition:h,draggable:u,validateMessage:f,validateStatus:g,directory:m}=t,y=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(t,["style","className","multiple","accept","disabled","children","capture","listType","prompt","promptPosition","draggable","validateMessage","validateStatus","directory"]),L=o(de,{[`${de}-picture`]:d===M.FILE_LIST_PIC,[`${de}-disabled`]:n,[`${de}-default`]:"default"===g,[`${de}-error`]:"error"===g,[`${de}-warning`]:"warning"===g,[`${de}-success`]:"success"===g},s),v=o(`${de}-hidden-input`),_=o(`${de}-hidden-input-replace`),E=o(`${de}-prompt`),b=o(`${de}-validate-message`),I=m?{directory:"directory",webkitdirectory:"webkitdirectory"}:{};return e.createElement("div",Object.assign({className:L,style:i,"x-prompt-pos":h},this.getDataAttr(y)),e.createElement("input",Object.assign({key:this.state.inputKey,capture:c,multiple:a,accept:r,onChange:this.onChange,type:"file",autoComplete:"off",tabIndex:-1,className:v,ref:this.inputRef},I)),e.createElement("input",{key:this.state.replaceInputKey,multiple:!1,accept:r,onChange:this.onReplaceChange,type:"file",autoComplete:"off",tabIndex:-1,className:_,ref:this.replaceInputRef}),this.renderAddContent(),p?e.createElement("div",{className:E,"x-semi-prop":"prompt"},p):null,f?e.createElement("div",{className:b,"x-semi-prop":"validateMessage"},f):null,this.renderFileList())}}pe.propTypes={accept:d.string,action:d.string.isRequired,addOnPasting:d.bool,afterUpload:d.func,beforeClear:d.func,beforeRemove:d.func,beforeUpload:d.func,children:d.node,className:d.string,customRequest:d.func,data:d.oneOfType([d.object,d.func]),defaultFileList:d.array,directory:d.bool,disabled:d.bool,dragIcon:d.node,dragMainText:d.node,dragSubText:d.node,draggable:d.bool,fileList:d.array,fileName:d.string,headers:d.oneOfType([d.object,d.func]),hotSpotLocation:d.oneOf(["start","end"]),itemStyle:d.object,limit:d.number,listType:d.oneOf(M.LIST_TYPE),maxSize:d.number,minSize:d.number,multiple:d.bool,name:d.string,onAcceptInvalid:d.func,onChange:d.func,onClear:d.func,onDrop:d.func,onError:d.func,onExceed:d.func,onFileChange:d.func,onOpenFileDialog:d.func,onPreviewClick:d.func,onProgress:d.func,onRemove:d.func,onRetry:d.func,onSizeError:d.func,onSuccess:d.func,onPastingError:d.func,previewFile:d.func,prompt:d.node,promptPosition:d.oneOf(M.PROMPT_POSITION),picWidth:d.oneOfType([d.number,d.string]),picHeight:d.oneOfType([d.number,d.string]),renderFileItem:d.func,renderPicPreviewIcon:d.func,renderFileOperation:d.func,renderPicInfo:d.func,renderThumbnail:d.func,showClear:d.bool,showPicInfo:d.bool,showReplace:d.bool,showRetry:d.bool,showUploadList:d.bool,style:d.object,timeout:d.number,transformFile:d.func,uploadTrigger:d.oneOf(M.UPLOAD_TRIGGER),validateMessage:d.node,validateStatus:d.oneOf(M.VALIDATE_STATUS),withCredentials:d.bool},pe.defaultProps={defaultFileList:[],disabled:!1,listType:"list",hotSpotLocation:"end",multiple:!1,onAcceptInvalid:p,onChange:p,beforeRemove:()=>!0,beforeClear:()=>!0,onClear:p,onDrop:p,onError:p,onExceed:p,onFileChange:p,onOpenFileDialog:p,onProgress:p,onRemove:p,onRetry:p,onSizeError:p,onSuccess:p,onPastingError:p,promptPosition:"right",showClear:!0,showPicInfo:!1,showReplace:!1,showRetry:!0,showUploadList:!0,uploadTrigger:"auto",withCredentials:!1},pe.FileCard=ce;const{Title:he}=A;function ue(){const{t:e}=O(),[t,s]=i.useState(!0),[a,r]=i.useState([]),[n,l]=i.useState(!1),o=`${h()}${u("upload")}?uuid=${f("uuid")}`,c=`${h()}${u("clear")}`,d=e=>l(e),p=e=>s(e);function v(t){y(e("New_Notify_Send"),t)}return g.jsx("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:g.jsx(I,{title:g.jsx(he,{heading:3,children:e("Image_OCR_Tool")}),style:{borderRadius:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:g.jsxs(F,{vertical:!0,align:"center",spacing:"loose",style:{width:"100%"},children:[g.jsx(pe,{action:o,picHeight:140,picWidth:140,listType:"picture",accept:".png,.jpeg,.jpg",enctype:"multipart/form-data",limit:1,onError:()=>p(!0),onSuccess:()=>p(!1),onClear:()=>{fetch(`${c}?filename=${f("uuid")}`).then(),p(!0),r([])},onRemove:()=>{fetch(`${c}?filename=${f("uuid")}`).then(),p(!0),r([])},children:g.jsxs("div",{style:{textAlign:"center"},children:[g.jsx(U,{size:"extra-large",style:{color:"#666"}}),g.jsx("p",{style:{margin:"8px 0 0",color:"#666"},children:e("Click_or_Drag_to_Upload")})]})}),g.jsx(P,{delay:100,spinning:n,children:g.jsx(_,{theme:"solid",type:"primary",size:"large",onClick:async function(){d(!0);try{const t=await fetch(`${h()}${u("start")}?uuid=${f("uuid")}`);!function(t){let i=[];""===t[0]?(i=[{key:e("Failed_OCR"),value:t[0]}],v(`${e("Failed_OCR")}${t[0]}`)):(i=[{key:e("Success_OCR_Text"),value:t[0]}],v(`${e("Success_OCR_Text")}${t[0]}`));r(i),d(!1)}(await t.json())}catch(t){m("Fetch Error","error",t),d(!1)}},disabled:t,style:{marginTop:"16px",padding:"0 32px",borderRadius:"8px"},children:e("Start_OCR")})}),a.length>0&&g.jsx(S,{data:a,style:{width:"100%",backgroundColor:"var(--semi-color-bg-1)",padding:"16px",borderRadius:"8px",marginTop:"16px"},row:!0}),g.jsx(L,{style:{textAlign:"start",width:"100%",backgroundColor:"var(--semi-color-bg-1)"},fullMode:!1,icon:null,closeIcon:null,title:g.jsx("div",{style:{fontWeight:600,fontSize:"14px",lineHeight:"20px"},children:e("How_use")}),description:g.jsx("div",{children:g.jsxs("ui",{children:[g.jsx("li",{children:e("Tip_Step1_Upload")}),g.jsx("li",{children:e("Tip_Step1_wait")}),g.jsx("li",{children:e("Tip_Step1_Click_Button")}),g.jsx("li",{children:e("Tip_Step1_Wait_result")})]})})})]})})})}export{ue as default};
