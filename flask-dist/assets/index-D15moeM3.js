import{r as e,M as t,j as n,u as s,V as o,W as r,f as i,X as c}from"./index-CiQzaChg.js";class u extends e.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function l({children:s,isPresent:o}){const r=e.useId(),i=e.useRef(null),c=e.useRef({width:0,height:0,top:0,left:0}),{nonce:l}=e.useContext(t);return e.useInsertionEffect((()=>{const{width:e,height:t,top:n,left:s}=c.current;if(o||!i.current||!e||!t)return;i.current.dataset.motionPopId=r;const u=document.createElement("style");return l&&(u.nonce=l),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${r}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${n}px !important;\n            left: ${s}px !important;\n          }\n        `),()=>{document.head.removeChild(u)}}),[o]),n.jsx(u,{isPresent:o,childRef:i,sizeRef:c,children:e.cloneElement(s,{ref:i})})}const a=({children:t,initial:r,isPresent:i,onExitComplete:c,custom:u,presenceAffectsLayout:a,mode:p})=>{const f=s(d),h=e.useId(),m=e.useCallback((e=>{f.set(e,!0);for(const t of f.values())if(!t)return;c&&c()}),[f,c]),x=e.useMemo((()=>({id:h,initial:r,isPresent:i,custom:u,onExitComplete:m,register:e=>(f.set(e,!1),()=>f.delete(e))})),a?[Math.random(),m]:[i,m]);return e.useMemo((()=>{f.forEach(((e,t)=>f.set(t,!1)))}),[i]),e.useEffect((()=>{!i&&!f.size&&c&&c()}),[i]),"popLayout"===p&&(t=n.jsx(l,{isPresent:i,children:t})),n.jsx(o.Provider,{value:x,children:t})};function d(){return new Map}const p=e=>e.key||"";function f(t){const n=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&n.push(t)})),n}const h=({children:t,custom:o,initial:u=!0,onExitComplete:l,presenceAffectsLayout:d=!0,mode:h="sync",propagate:m=!1})=>{const[x,g]=r(m),E=e.useMemo((()=>f(t)),[t]),C=m&&!x?[]:E.map(p),P=e.useRef(!0),R=e.useRef(E),j=s((()=>new Map)),[v,w]=e.useState(E),[y,M]=e.useState(E);i((()=>{P.current=!1,R.current=E;for(let e=0;e<y.length;e++){const t=p(y[e]);C.includes(t)?j.delete(t):!0!==j.get(t)&&j.set(t,!1)}}),[y,C.length,C.join("-")]);const L=[];if(E!==v){let e=[...E];for(let t=0;t<y.length;t++){const n=y[t],s=p(n);C.includes(s)||(e.splice(t,0,n),L.push(n))}return"wait"===h&&L.length&&(e=L),M(f(e)),void w(E)}const{forceRender:$}=e.useContext(c);return n.jsx(n.Fragment,{children:y.map((e=>{const t=p(e),s=!(m&&!x)&&(E===y||C.includes(t));return n.jsx(a,{isPresent:s,initial:!(P.current&&!u)&&void 0,custom:s?void 0:o,presenceAffectsLayout:d,mode:h,onExitComplete:s?void 0:()=>{if(!j.has(t))return;j.set(t,!0);let e=!0;j.forEach((t=>{t||(e=!1)})),e&&(null==$||$(),M(R.current),m&&(null==g||g()),l&&l())},children:e},t)}))})};export{h as A};
