import{_ as e}from"./pick-C2YSPQei.js";import{N as t,K as s,U as i,R as n,$ as o,W as r,a0 as a,P as h}from"./index-BEnZJKm2.js";class p extends t{constructor(e){super(Object.assign({},e)),this.updateDOMInRenderTree=e=>{this._adapter.setDOMInRenderTree(e)},this.updateDOMHeight=e=>{this._adapter.setDOMHeight(e)},this.updateVisible=e=>{this._adapter.setVisible(e)},this.updateIsTransitioning=e=>{this._adapter.setIsTransitioning(e)}}}const d=`${s}-collapsible`;class l extends i{constructor(e){super(e),this.domRef=n.createRef(),this.hasBeenRendered=!1,this.handleResize=e=>{const t=e[0];if(t){const e=l.getEntryInfo(t);this.foundation.updateDOMHeight(e.height),this.foundation.updateDOMInRenderTree(e.isShown)}},this.isChildrenInRenderTree=()=>!!this.domRef.current&&this.domRef.current.offsetHeight>0,this.state={domInRenderTree:!1,domHeight:0,visible:this.props.isOpen,isTransitioning:!1},this.foundation=new p(this.adapter)}get adapter(){return Object.assign(Object.assign({},super.adapter),{setDOMInRenderTree:e=>{this.state.domInRenderTree!==e&&this.setState({domInRenderTree:e})},setDOMHeight:e=>{this.state.domHeight!==e&&this.setState({domHeight:e})},setVisible:e=>{this.state.visible!==e&&this.setState({visible:e})},setIsTransitioning:e=>{this.state.isTransitioning!==e&&this.setState({isTransitioning:e})}})}componentDidMount(){super.componentDidMount(),this.resizeObserver=new ResizeObserver(this.handleResize),this.resizeObserver.observe(this.domRef.current);const e=this.isChildrenInRenderTree();this.foundation.updateDOMInRenderTree(e),e&&this.foundation.updateDOMHeight(this.domRef.current.scrollHeight)}componentDidUpdate(t,s,i){const n=Object.keys(e(this.props,["reCalcKey","isOpen"])).filter((e=>!o(this.props[e],t[e]))),r=Object.keys(e(this.state,["domInRenderTree"])).filter((e=>!o(this.state[e],s[e])));n.includes("reCalcKey")&&this.foundation.updateDOMHeight(this.domRef.current.scrollHeight),r.includes("domInRenderTree")&&this.state.domInRenderTree&&this.foundation.updateDOMHeight(this.domRef.current.scrollHeight),n.includes("isOpen")&&(!this.props.isOpen&&this.props.motion||this.foundation.updateVisible(this.props.isOpen)),this.props.motion&&t.isOpen!==this.props.isOpen&&this.foundation.updateIsTransitioning(!0)}componentWillUnmount(){super.componentWillUnmount(),this.resizeObserver.disconnect()}render(){const e=Object.assign({overflow:"hidden",height:this.props.isOpen?this.state.domHeight:this.props.collapseHeight,opacity:this.props.isOpen||!this.props.fade||0!==this.props.collapseHeight?1:0,transitionDuration:`${this.props.motion&&this.state.isTransitioning?this.props.duration:0}ms`},this.props.style),t=r(`${d}-wrapper`,{[`${d}-transition`]:this.props.motion&&this.state.isTransitioning},this.props.className),s=this.props.keepDOM&&(!this.props.lazyRender||this.hasBeenRendered)||0!==this.props.collapseHeight||this.state.visible||this.props.isOpen;return s&&!this.hasBeenRendered&&(this.hasBeenRendered=!0),n.createElement("div",Object.assign({className:t,style:e,onTransitionEnd:()=>{var e,t;this.props.isOpen||this.foundation.updateVisible(!1),this.foundation.updateIsTransitioning(!1),null===(t=(e=this.props).onMotionEnd)||void 0===t||t.call(e)}},this.getDataAttr(this.props)),n.createElement("div",{"x-semi-prop":"children",ref:this.domRef,style:{overflow:"hidden"},id:this.props.id},s&&this.props.children))}}l.__SemiComponentName__="Collapsible",l.defaultProps=a(l.__SemiComponentName__,{isOpen:!1,duration:250,motion:!0,keepDOM:!1,lazyRender:!1,collapseHeight:0,fade:!1}),l.getEntryInfo=e=>{let t;t=e.borderBoxSize?!(0===e.borderBoxSize[0].blockSize&&0===e.borderBoxSize[0].inlineSize):!(0===e.contentRect.height&&0===e.contentRect.width);let s=0;if(e.borderBoxSize)s=Math.ceil(e.borderBoxSize[0].blockSize);else{s=e.target.clientHeight}return{isShown:t,height:s}},l.propTypes={motion:h.bool,children:h.node,isOpen:h.bool,duration:h.number,keepDOM:h.bool,collapseHeight:h.number,style:h.object,className:h.string,reCalcKey:h.oneOfType([h.string,h.number])};export{l as C};
