import{R as e,r as t,P as i,i as a,f as s,j as r,e as n}from"./index-B93kzz_1.js";import{B as l,a as o}from"./pick-saSZ4uyX.js";import{a as c,L as d,C as p,S as h,T as u}from"./index-sw4Tt9-H.js";import{D as f}from"./index-D1X-lcZg.js";import{V as g,i as m,S as y}from"./isPromise-BOKwgLAu.js";import{c as v,B as L,i as E,P as _,k as b,H as I,m as S,v as F,p as A,u as P,g as w,s as T}from"./AppContent-DNe_3nC0.js";import{P as C}from"./index-Dx9lLVhg.js";import{I as R}from"./IconClear-_a5P9oDU.js";import{I as x}from"./IconFile-fkWib_H5.js";import"./isPlainObject-BHD4x_c9.js";const O=v((function(e){return t.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),t.createElement("path",{d:"M20.5 13.5a1.5 1.5 0 0 0 0-3h-7v-7a1.5 1.5 0 0 0-3 0v7h-7a1.5 1.5 0 0 0 0 3h7v7a1.5 1.5 0 0 0 3 0v-7h7Z",fill:"currentColor"}))}),"plus");const U=v((function(e){return t.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.5 12a7.5 7.5 0 0 1 13.8-4.07l-2-.4a1.5 1.5 0 0 0-.6 2.94l5 1c.76.15 1.51-.3 1.74-1.04l1.5-5a1.5 1.5 0 1 0-2.88-.86l-.43 1.45A10.49 10.49 0 0 0 1.5 12a10.5 10.5 0 0 0 20.4 3.5 1.5 1.5 0 1 0-2.83-1A7.5 7.5 0 0 1 4.5 12Z",fill:"currentColor"}))}),"refresh");const D=v((function(e){return t.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.84 8.06A6.5 6.5 0 1 0 5.18 11 4.5 4.5 0 0 0 5.5 20H17a6 6 0 0 0 .84-11.94Zm-5.52.2a.5.5 0 0 0-.64 0l-5.15 4.3a.25.25 0 0 0 .16.44H10v4.5c0 .28.22.5.5.5h3a.5.5 0 0 0 .5-.5V13h3.31c.23 0 .34-.3.16-.44l-5.15-4.3Z",fill:"currentColor"}))}),"upload"),$="picture",k="list",j={PREFIX:`${L}-upload`},N="auto",z={FILE_STATUS_UPLOADING:"uploading",FILE_STATUS_SUCCESS:"success",FILE_STATUS_UPLOAD_FAIL:"uploadFail",FILE_STATUS_VALIDATING:"validating",FILE_STATUS_VALID_FAIL:"validateFail",FILE_STATUS_WAIT_UPLOAD:"wait",FILE_LIST_PIC:$,FILE_LIST_DEFAULT:k,LIST_TYPE:[$,k],DRAG_AREA_DEFAULT:"default",DRAG_AREA_LEGAL:"legal",DRAG_AREA_ILLEGAL:"illegal",TRIGGER_AUTO:N,UPLOAD_TRIGGER:[N,"custom"],VALIDATE_STATUS:g,PROMPT_POSITION:["left","right","bottom"]},M=.95;var G=function(e,t,i,a){return new(i||(i=Promise))((function(s,r){function n(e){try{o(a.next(e))}catch(t){r(t)}}function l(e){try{o(a.throw(e))}catch(t){r(t)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,l)}o((a=a.apply(e,t||[])).next())}))};const B=1024,H=1048576;function V(e){return e<B?`${(e/B).toFixed(2)}KB`:e>=B&&e<H?`${(e/B).toFixed(1)}KB`:e>=H?`${(e/H).toFixed(1)}MB`:void 0}function W(e){return G(this,void 0,void 0,(function*(){const t=[],i=(e,a)=>G(this,void 0,void 0,(function*(){if(a=a||"",e.path=a,e.isFile)t.push(new Promise(((t,i)=>{e.file((i=>{e.fullPath&&!i.webkitRelativePath&&(Object.defineProperties(i,{webkitRelativePath:{writable:!0}}),i.webkitRelativePath=e.fullPath.replace(/^\//,""),Object.defineProperties(i,{webkitRelativePath:{writable:!1}})),t(i)}),i)})));else if(e.isDirectory){const t=yield function(e){return G(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const a=e.createReader();let s=[];!function e(){a.readEntries((i=>{const a=Array.prototype.slice.apply(i);s=s.concat(a),a.length?e():t(s)}),i)}()}))}))}(e);for(let s=0;s<t.length;s++){const r=t[s];yield i(r,`${a}${e.name}/`)}}}));try{const a=e.map((e=>i(e.webkitGetAsEntry())));yield Promise.all(a);return yield Promise.all(t)}catch(a){return[]}}))}var q=function(e,t,i,a){return new(i||(i=Promise))((function(s,r){function n(e){try{o(a.next(e))}catch(t){r(t)}}function l(e){try{o(a.throw(e))}catch(t){r(t)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,l)}o((a=a.apply(e,t||[])).next())}))};const{FILE_STATUS_UPLOADING:K,FILE_STATUS_SUCCESS:Z,FILE_STATUS_UPLOAD_FAIL:X,FILE_STATUS_VALID_FAIL:Y,FILE_STATUS_WAIT_UPLOAD:J,DRAG_AREA_DEFAULT:Q,DRAG_AREA_LEGAL:ee,TRIGGER_AUTO:te}=z;class ie extends E{constructor(e){super(Object.assign({},e)),this.destroyState=!1}init(){this.destroyState=!1;const{disabled:e,addOnPasting:t}=this.getProps();t&&!e&&this.bindPastingHandler()}destroy(){const{disabled:e,addOnPasting:t}=this.getProps();this.releaseMemory(),e||this.unbindPastingHandler(),this.destroyState=!0}getError(e){let{action:t,xhr:i,message:a,fileName:s}=e;const r=i?i.status:0,n=new Error(a||`cannot post ${s} to ${t}, xhr status: ${r}'`);return n.status=r,n.method="post",n.url=t,n}getBody(e){if(!e)return;const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(i){return t}}checkFileSize(e){const{size:t}=e,{maxSize:i,minSize:a}=this.getProps();let s=!1;return(t>i*B||t<a*B)&&(s=!0),s}handleChange(e){const t=[],{limit:i,transformFile:a,accept:s}=this.getProps(),{fileList:r}=this.getStates();let n=Array.from(e);if(void 0!==s&&(n=n.filter((e=>{const i=this.checkFileFormat(s,e);return i||t.push(e),i})),0!==t.length&&this._adapter.notifyAcceptInvalid(t),0===n.length))return;n=n.map((e=>(a&&(e=a(e)),e.uid||(e.uid=_()),this.checkFileSize(e)&&(e._sizeInvalid=!0,e.status=Y,this._adapter.notifySizeError(e,r)),e)));const l=r.length+n.length;if(void 0!==i&&l>i){if(this._adapter.notifyExceed(n),1===i)return n=n.slice(-1),this._adapter.notifyFileSelect(n),this._adapter.resetInput(),void this.replaceFileList(n);const e=i-r.length;n=n.slice(0,e)}this._adapter.notifyFileSelect(n),this._adapter.resetInput(),this.addFilesToList(n)}handleReplaceChange(e){if(0===e.length)return;const{transformFile:t,uploadTrigger:i,accept:a}=this.getProps(),{replaceIdx:s,fileList:r}=this.getStates();let n=Array.from(e).pop();if(void 0!==a&&!this.checkFileFormat(a,n))return void this._adapter.notifyAcceptInvalid([n]);t&&(n=t(n)),n.uid||(n.uid=_()),this.checkFileSize(n)&&(n._sizeInvalid=!0,n.status=Y,this._adapter.notifySizeError(n,r)),this._adapter.notifyFileSelect([n]);const l=this.buildFileItem(n,i),o=[...r];o.splice(s,1,l),this._adapter.notifyChange({currentFile:l,fileList:o}),this._adapter.updateFileList(o,(()=>{this._adapter.resetReplaceInput(),l._sizeInvalid||this.upload(l)}))}buildFileItem(e,t){const{_sizeInvalid:i,status:a}=e;try{delete e._sizeInvalid,delete e.status}catch(r){}const s={status:a||(t===te?K:J),name:e.name,size:V(e.size),uid:e.uid,percent:0,fileInstance:e,url:this._createURL(e)};return i&&(s._sizeInvalid=!0),this.isImage(e)&&(s.preview=!0),s}replaceFileList(e){const{uploadTrigger:t}=this.getProps(),i=e.map((e=>this.buildFileItem(e,t)));this._adapter.notifyChange({fileList:i,currentFile:i[0]}),this._adapter.updateFileList(i,(()=>{t===te&&this.startUpload(i)}))}addFilesToList(e){const t=this.getState("fileList").slice(),{uploadTrigger:i}=this.getProps(),a=e.map((e=>this.buildFileItem(e,i)));a.forEach((e=>{const i=t.findIndex((t=>t.uid===e.uid));-1!==i?t[i]=e:(t.push(e),this._adapter.notifyChange({fileList:t,currentFile:e}))})),this._adapter.updateFileList(t,(()=>{i===te&&this.startUpload(a)}))}insertFileToList(e,t){const{limit:i,transformFile:a,accept:s,uploadTrigger:r}=this.getProps(),{fileList:n}=this.getStates(),l=[];let o=Array.from(e);if(void 0!==s&&(o=o.filter((e=>{const t=this.checkFileFormat(s,e);return t||l.push(e),t})),0!==l.length&&this._adapter.notifyAcceptInvalid(l),0===o.length))return;o=o.map((e=>(e.uid||(e.uid=_()),this.checkFileSize(e)&&(e._sizeInvalid=!0,e.status=Y,this._adapter.notifySizeError(e,n)),a&&(e=a(e)),e)));const c=n.length+o.length;if(void 0!==i&&c>i){if(1===i)return o=o.slice(-1),this._adapter.notifyFileSelect(o),this._adapter.resetInput(),void this.replaceFileList(o);const e=i-n.length;o=o.slice(0,e),this._adapter.notifyExceed(o)}const d=o.map((e=>this.buildFileItem(e,r))),p=n.slice();void 0!==t?p.splice(t,0,...d):p.push(...d),this._adapter.notifyFileSelect(o),this._adapter.notifyChange({fileList:p,currentFile:null}),this._adapter.updateFileList(p,(()=>{r===te&&this.startUpload(d)}))}manualUpload(){const e=this.getState("fileList").filter((e=>e.status===J));this.startUpload(e)}startUpload(e){e.forEach((e=>{e._sizeInvalid||this.upload(e)}))}upload(e){const{beforeUpload:t}=this.getProps();if(void 0!==t){if("function"==typeof t){const{fileList:t}=this.getStates(),i=this._adapter.notifyBeforeUpload({file:e,fileList:t});switch(!0){case!0===i:this.post(e);break;case!1===i:{const t={shouldUpload:!1,status:z.FILE_STATUS_VALID_FAIL};this.handleBeforeUploadResultInObject(t,e);break}case i&&m(i):Promise.resolve(i).then((t=>{let i={shouldUpload:!0};"Object"===Object.prototype.toString.call(t).slice(8,-1)&&(i=Object.assign(Object.assign({},i),t)),this.handleBeforeUploadResultInObject(i,e)}),(t=>{let i={shouldUpload:!1,status:z.FILE_STATUS_VALID_FAIL};"Object"===Object.prototype.toString.call(t).slice(8,-1)&&(i=Object.assign(Object.assign({},i),t)),this.handleBeforeUploadResultInObject(i,e)}));break;case"object"==typeof i:this.handleBeforeUploadResultInObject(i,e)}}}else this.post(e)}handleBeforeUploadResultInObject(e,t){const{shouldUpload:i,status:a,autoRemove:s,validateMessage:r,fileInstance:n}=e;let l=this.getState("fileList").slice();if(s)l=l.filter((e=>e.uid!==t.uid));else{const e=this._getFileIndex(t,l);if(e<0)return;a&&(l[e].status=a),r&&(l[e].validateMessage=r),n&&(n.uid=t.uid,l[e].fileInstance=n,l[e].size=V(n.size),l[e].name=n.name,l[e].url=this._createURL(n)),l[e].shouldUpload=i}this._adapter.updateFileList(l),this._adapter.notifyChange({fileList:l,currentFile:t}),i&&this.post(t)}post(e){const{fileInstance:t}=e,i=this.getProps();if("undefined"==typeof XMLHttpRequest)return;const a=new XMLHttpRequest,s=new FormData,{action:r}=i;let{data:n}=i;n&&("function"==typeof n&&(n=n(t)),Object.keys(n).forEach((e=>{s.append(e,n[e])})));const l=i.name||i.fileName||t.name;if(i.customRequest)return i.customRequest({fileName:l,data:n,file:e,fileInstance:t,onProgress:e=>this.handleProgress({e:e,fileInstance:t}),onError:(e,i)=>this.handleError({e:i,xhr:e,fileInstance:t}),onSuccess:(e,i)=>this.handleSuccess({response:e,fileInstance:t,e:i,isCustomRequest:!0}),withCredentials:i.withCredentials,action:i.action});s.append(l,t),a.open("post",r,!0),i.withCredentials&&"withCredentials"in a&&(a.withCredentials=!0),a.upload&&(a.upload.onprogress=e=>{this.destroyState?a.abort():this.handleProgress({e:e,fileInstance:t})}),a.onload=e=>{this.destroyState||this.handleOnLoad({e:e,xhr:a,fileInstance:t})},a.onerror=e=>{this.destroyState||this.handleError({e:e,xhr:a,fileInstance:t})};let o=i.headers||{};"function"==typeof o&&(o=o(t));for(const c in o)Object.prototype.hasOwnProperty.call(o,c)&&null!==o[c]&&a.setRequestHeader(c,o[c]);a.send(s)}handleProgress(e){let{e:t,fileInstance:i}=e;const{fileList:a}=this.getStates(),s=a.slice();let r=0;t.total>0&&(r=Number((t.loaded/t.total*100*M).toFixed(0))||0);const n=this._getFileIndex(i,s);n<0||(s[n].percent=r,s[n].status=K,this._adapter.notifyProgress(r,i,s),this._adapter.updateFileList(s),this._adapter.notifyChange({fileList:s,currentFile:s[n]}))}handleOnLoad(e){let{e:t,xhr:i,fileInstance:a}=e;const{fileList:s}=this.getStates(),r=this._getFileIndex(a,s);r<0||(i.status<200||i.status>=300?this.handleError({e:t,xhr:i,fileInstance:a}):this.handleSuccess({e:t,xhr:i,fileInstance:a,index:r}))}handleSuccess(e){let{e:t,fileInstance:i,isCustomRequest:a=!1,xhr:s,response:r}=e;const{fileList:n}=this.getStates();let l=null;const o=this._getFileIndex(i,n);if(o<0)return;l=a?r:this.getBody(s);const c=n.slice(),{afterUpload:d}=this.getProps();if(c[o].status=Z,c[o].percent=100,this._adapter.notifyProgress(100,i,c),c[o].response=l,t&&(c[o].event=t),d&&"function"==typeof d){const{autoRemove:e,status:t,validateMessage:i,name:a,url:s}=this._adapter.notifyAfterUpload({response:l,file:c[o],fileList:c})||{};t&&(c[o].status=t),i&&(c[o].validateMessage=i),a&&(c[o].name=a),s&&(c[o].url=s),e&&c.splice(o,1)}this._adapter.notifySuccess(l,i,c),this._adapter.notifyChange({fileList:c,currentFile:c[o]}),this._adapter.updateFileList(c)}_getFileIndex(e,t){return t.findIndex((t=>t.uid===e.uid))}handleRemove(e){const{disabled:t}=this.getProps();if(t)return;const{fileList:i}=this.getStates();Promise.resolve(this._adapter.notifyBeforeRemove(e,i)).then((t=>{if(!1===t)return;const a=i.slice(),s=this._getFileIndex(e,i);s<0||(a.splice(s,1),this._adapter.notifyRemove(e.fileInstance,a,e),this._adapter.updateFileList(a),this._adapter.notifyChange({fileList:a,currentFile:e}))}))}handleError(e){let{e:t,xhr:i,fileInstance:a}=e;const{fileList:s}=this.getStates(),r=this._getFileIndex(a,s);if(r<0)return;const{action:n}=this.getProps(),l=s.slice(),o=this.getError({action:n,xhr:i,fileName:a.name});l[r].status=X,l[r].response=o,l[r].event=t,this._adapter.notifyError(o,a,l,i),this._adapter.updateFileList(l),this._adapter.notifyChange({currentFile:l[r],fileList:l})}handleClear(){const{disabled:e}=this.getProps(),{fileList:t}=this.getStates();e||Promise.resolve(this._adapter.notifyBeforeClear(t)).then((e=>{!1!==e&&(this._adapter.updateFileList([]),this._adapter.notifyClear(),this._adapter.notifyChange({fileList:[]}))})).catch((e=>{}))}_createURL(e){const t=URL.createObjectURL(e),{localUrls:i}=this.getStates(),a=i.slice();return a.push(t),this._adapter.updateLocalUrls(a),t}releaseMemory(){const{localUrls:e}=this.getStates();e.forEach((e=>{this._releaseBlob(e)}))}_releaseBlob(e){try{URL.revokeObjectURL(e)}catch(t){}}isImage(e){return/(webp|svg|png|gif|jpg|jpeg|bmp|dpg)$/i.test(e.type)}isMultiple(){return Boolean(this.getProp("multiple"))}handleDragEnter(e){e.preventDefault(),e.stopPropagation(),this._dragEnterTarget=e.currentTarget;const{disabled:t}=this.getProps();t||this._adapter.updateDragAreaStatus(ee)}handleDirectoryDrop(e){return q(this,void 0,void 0,(function*(){const t=this.getState("fileList").slice(),i=[].slice.call(e.dataTransfer.items),a=yield W(i);this.handleChange(a),this._adapter.updateDragAreaStatus(Q),this._adapter.notifyDrop(e,a,t)}))}handleDrop(e){e.preventDefault(),e.stopPropagation();const{disabled:t,directory:i}=this.getProps(),a=this.getState("fileList").slice();if(!t){if(i)return void this.handleDirectoryDrop(e);const t=Array.from(e.dataTransfer.files);this.handleChange(t),this._adapter.updateDragAreaStatus(Q),this._adapter.notifyDrop(e,t,a)}}handleDragOver(e){e.preventDefault(),e.stopPropagation()}handleDragLeave(e){e.preventDefault(),e.stopPropagation(),this._dragEnterTarget===e.target&&this._adapter.updateDragAreaStatus(Q)}checkFileFormat(e,t){const i=e.split(",").map((e=>e.trim())).filter((e=>e)),a=t.type||"",s=a.replace(/\/.*$/,"");return i.some((e=>{if("."===e.charAt(0)){const a=t.name||"",s=e.split(".").pop().toLowerCase();return i=a.toLowerCase(),r=s,-1!==i.indexOf(r,i.length-r.length)}var i,r;if(/\/\*$/.test(e)){const t=e.replace(/\/.*$/,"");return s===t}return!!/^[^\/]+\/[^\/]+$/.test(e)&&a===e}))}retry(e){const{onRetry:t}=this.getProps();t&&"function"==typeof t&&t(e),this.post(e)}handlePreviewClick(e){this._adapter.notifyPreviewClick(e)}readFileFromClipboard(e){for(const t of e)for(const e of t.types)e.startsWith("image")&&t.getType(e).then((e=>e.arrayBuffer())).then((t=>{const i=e.split("/")[1],a=new File([t],`upload.${i}`,{type:e});this.handleChange([a])}))}handlePasting(e){const t=this._adapter.isMac()?e.metaKey:e.ctrlKey,{addOnPasting:i}=this.getProps();if(i&&t&&"KeyV"===e.code){const e="clipboard-read";navigator.permissions.query({name:e}).then((e=>{"granted"===e.state||"prompt"===e.state?navigator.clipboard.read().then((e=>{this.readFileFromClipboard(e)})):this._adapter.notifyPastingError(e)})).catch((e=>{this._adapter.notifyPastingError(e)}))}}bindPastingHandler(){this._adapter.registerPastingHandler((e=>this.handlePasting(e)))}unbindPastingHandler(){this._adapter.unRegisterPastingHandler()}}class ae extends E{constructor(e){super(Object.assign({},e))}handleImageError(e){this._adapter.updateFallbackPreview(!0)}}const se=j.PREFIX,re=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.createElement("svg",Object.assign({focusable:!1,"aria-hidden":!0,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("circle",{cx:"7.99992",cy:"7.99992",r:"6.66667",fill:"white"}),e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.3332 8.00008C15.3332 12.0502 12.0499 15.3334 7.99984 15.3334C3.94975 15.3334 0.666504 12.0502 0.666504 8.00008C0.666504 3.94999 3.94975 0.666748 7.99984 0.666748C12.0499 0.666748 15.3332 3.94999 15.3332 8.00008ZM8.99984 11.6667C8.99984 11.1145 8.55212 10.6667 7.99984 10.6667C7.44755 10.6667 6.99984 11.1145 6.99984 11.6667C6.99984 12.219 7.44755 12.6667 7.99984 12.6667C8.55212 12.6667 8.99984 12.219 8.99984 11.6667ZM7.99984 3.33341C7.27573 3.33341 6.7003 3.94171 6.74046 4.66469L6.94437 8.33495C6.97549 8.89513 7.4388 9.33341 7.99984 9.33341C8.56087 9.33341 9.02419 8.89513 9.05531 8.33495L9.25921 4.66469C9.29938 3.94171 8.72394 3.33341 7.99984 3.33341Z",fill:"#F93920"}))},ne=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.createElement("svg",Object.assign({focusable:!1,"aria-hidden":!0,width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("circle",{cx:"14",cy:"14",r:"14",fill:"#16161A",fillOpacity:"0.6"}),e.createElement("path",{d:"M9 10.25V18.25L10.25 13.25H17.875V11.75C17.875 11.4739 17.6511 11.25 17.375 11.25H14L12.75 9.75H9.5C9.22386 9.75 9 9.97386 9 10.25Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),e.createElement("path",{d:"M18 18.25L19 13.25H10.2031L9 18.25H18Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},le=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.createElement("svg",Object.assign({focusable:!1,"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),e.createElement("path",{d:"M6 17V7.58824C6 7.26336 6.26863 7 6.6 7H10.5L12 8.76471H16.05C16.3814 8.76471 16.65 9.02806 16.65 9.35294V11.1176H7.5L6 17ZM6 17L7.44375 11.1176H18L16.8 17L6 17Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}))};class oe extends b{constructor(e){super(e),this.state={fallbackPreview:!1},this.foundation=new ae(this.adapter)}get adapter(){return Object.assign(Object.assign({},super.adapter),{updateFallbackPreview:e=>this.setState({fallbackPreview:e})})}transSize(e){return"number"==typeof e?V(e):e}renderValidateMessage(){const{status:t,validateMessage:i}=this.props;let a=null;switch(!0){case"string"==typeof i&&t===z.FILE_STATUS_VALIDATING:a=e.createElement(e.Fragment,null,e.createElement(y,{size:"small",wrapperClassName:`${se}-file-card-icon-loading`}),i);break;case"string"==typeof i:a=e.createElement(e.Fragment,null,e.createElement(I,{className:`${se}-file-card-icon-error`}),i);break;case s=i,e.isValidElement(s):a=i}var s;return a}renderPicValidateMsg(){const{status:t,validateMessage:i}=this.props;let a=null;switch(!0){case i&&t===z.FILE_STATUS_VALIDATING:a=e.createElement(y,{size:"small",wrapperClassName:`${se}-picture-file-card-icon-loading`});break;case i&&(t===z.FILE_STATUS_VALID_FAIL||t===z.FILE_STATUS_UPLOAD_FAIL):a=e.createElement("div",{className:`${se}-picture-file-card-icon-error`},e.createElement(re,null))}return a?e.createElement(c,{content:i,trigger:"hover",position:"bottom"},a):null}renderPic(t){const{fallbackPreview:i}=this.state,{url:a,percent:s,status:r,disabled:n,style:l,onPreviewClick:o,showPicInfo:d,renderPicInfo:p,renderPicPreviewIcon:h,renderThumbnail:u,name:f,index:g,picHeight:m,picWidth:y}=this.props,v=r===z.FILE_STATUS_UPLOADING&&100!==s,L=r===z.FILE_STATUS_UPLOAD_FAIL&&this.props.showRetry,E=r===z.FILE_STATUS_SUCCESS&&this.props.showReplace,_=r===z.FILE_STATUS_SUCCESS&&!this.props.showReplace,b="function"==typeof u,I=S({[`${se}-picture-file-card`]:!0,[`${se}-picture-file-card-preview-fallback`]:i,[`${se}-picture-file-card-disabled`]:n,[`${se}-picture-file-card-show-pointer`]:void 0!==o,[`${se}-picture-file-card-error`]:r===z.FILE_STATUS_UPLOAD_FAIL,[`${se}-picture-file-card-uploading`]:v,[`${se}-picture-file-card-custom-thumbnail`]:b&&m&&y}),F=e.createElement("div",{role:"button",tabIndex:0,className:`${se}-picture-file-card-retry`,onClick:e=>this.onRetry(e)},e.createElement(U,{className:`${se}-picture-file-card-icon-retry`})),A=e.createElement(c,{trigger:"hover",position:"top",content:t.replace,showArrow:!1,spacing:4},e.createElement("div",{role:"button",tabIndex:0,className:`${se}-picture-file-card-replace`,onClick:e=>this.onReplace(e)},e.createElement(ne,{className:`${se}-picture-file-card-icon-replace`}))),P=e.createElement("div",{className:`${se}-picture-file-card-preview`},"function"==typeof h?h(this.props):null),w=e.createElement("div",{role:"button",tabIndex:0,className:`${se}-picture-file-card-close`,onClick:e=>this.onRemove(e)},e.createElement(R,{className:`${se}-picture-file-card-icon-close`})),T="function"==typeof p?p(this.props):e.createElement("div",{className:`${se}-picture-file-card-pic-info`},g+1);let O={},D=l?Object.assign({},l):{};m&&(D.height=m,O.height=m),y&&(D.width=y,O.width=y);const $=i?e.createElement(x,{size:"large"}):e.createElement("img",{src:a,alt:f,onError:e=>this.foundation.handleImageError(e),style:O}),k=b?u(this.props):$;return e.createElement("div",{role:"listitem",className:I,style:D,onClick:o},k,v?e.createElement(C,{percent:s,type:"circle",size:"small",orbitStroke:"#FFF","aria-label":"uploading file progress"}):null,L?F:null,E&&A,_&&P,d&&T,!n&&w,this.renderPicValidateMsg())}renderFile(t){const{name:i,size:a,percent:s,url:r,showRetry:n,showReplace:o,preview:d,previewFile:p,status:h,style:u,onPreviewClick:f,renderFileOperation:g}=this.props,{fallbackPreview:m}=this.state,y=S({[`${se}-file-card`]:!0,[`${se}-file-card-fail`]:h===z.FILE_STATUS_VALID_FAIL||h===z.FILE_STATUS_UPLOAD_FAIL,[`${se}-file-card-show-pointer`]:void 0!==f}),v=S({[`${se}-file-card-preview`]:!0,[`${se}-file-card-preview-placeholder`]:!d||p||m}),L=`${se}-file-card-info`,E=`${se}-file-card-close`,_=`${se}-file-card-replace`,b=!(100===s||void 0===s)&&h===z.FILE_STATUS_UPLOADING,I=h===z.FILE_STATUS_UPLOAD_FAIL&&n,A=h===z.FILE_STATUS_SUCCESS&&o,P=this.transSize(a);let w=d&&!m?e.createElement("img",{src:r,alt:i,onError:e=>this.foundation.handleImageError(e)}):e.createElement(x,{size:"large"});p&&(w=p(this.props));const T="function"==typeof g?g(this.props):e.createElement(l,{onClick:e=>this.onRemove(e),type:"tertiary",icon:e.createElement(F,null),theme:"borderless",size:"small",className:E});return e.createElement("div",{role:"listitem",className:y,style:u,onClick:f},e.createElement("div",{className:v},w),e.createElement("div",{className:`${L}-main`},e.createElement("div",{className:`${L}-main-text`},e.createElement("span",{className:`${L}-name`},i),e.createElement("span",null,e.createElement("span",{className:`${L}-size`},P),A&&e.createElement(c,{trigger:"hover",position:"top",showArrow:!1,content:t.replace},e.createElement(l,{onClick:e=>this.onReplace(e),type:"tertiary",theme:"borderless",size:"small",icon:e.createElement(le,null),className:_})))),b?e.createElement(C,{percent:s,style:{width:"100%"},"aria-label":"uploading file progress"}):null,e.createElement("div",{className:`${L}-main-control`},e.createElement("span",{className:`${L}-validate-message`},this.renderValidateMessage()),I?e.createElement("span",{role:"button",tabIndex:0,className:`${L}-retry`,onClick:e=>this.onRetry(e)},t.retry):null)),T)}onRemove(e){e.stopPropagation(),this.props.onRemove()}onReplace(e){e.stopPropagation(),this.props.onReplace()}onRetry(e){e.stopPropagation(),this.props.onRetry()}render(){const{listType:t}=this.props;return t===z.FILE_LIST_PIC?e.createElement(d,{componentName:"Upload"},(e=>this.renderPic(e))):t===z.FILE_LIST_DEFAULT?e.createElement(d,{componentName:"Upload"},(e=>this.renderFile(e))):null}}oe.propTypes={className:i.string,disabled:i.bool,listType:i.string,name:i.string,onPreviewClick:i.func,onRemove:i.func,onReplace:i.func,onRetry:i.func,percent:i.number,preview:i.bool,previewFile:i.func,picWidth:i.oneOfType([i.number,i.string]),picHeight:i.oneOfType([i.number,i.string]),showReplace:i.bool,showRetry:i.bool,size:i.oneOfType([i.number,i.string]),status:i.string,style:i.object,url:i.string,validateMessage:i.node,index:i.number},oe.defaultProps={listType:z.FILE_LIST_DEFAULT,name:"",onRemove:()=>{},onRetry:()=>{},preview:!1,size:""};const ce=j.PREFIX;class de extends b{constructor(t){super(t),this.inputRef=null,this.replaceInputRef=null,this.onClick=()=>{const{inputRef:e,props:t}=this,{onOpenFileDialog:i}=t;!Boolean(this.props.disabled)&&e&&e.current&&(e.current.click(),i&&i())},this.onChange=e=>{const{files:t}=e.target;this.foundation.handleChange(t)},this.replace=e=>{this.setState({replaceIdx:e},(()=>{this.replaceInputRef.current.click()}))},this.onReplaceChange=e=>{const{files:t}=e.target;this.foundation.handleReplaceChange(t)},this.clear=()=>{this.foundation.handleClear()},this.remove=e=>{this.foundation.handleRemove(e)},this.insert=(e,t)=>this.foundation.insertFileToList(e,t),this.upload=()=>{this.foundation.manualUpload()},this.openFileDialog=()=>{this.onClick()},this.renderFile=(t,i,a)=>{const{name:s,status:r,validateMessage:n,_sizeInvalid:l,uid:c}=t,{previewFile:d,listType:p,itemStyle:h,showPicInfo:u,renderPicInfo:f,renderPicPreviewIcon:g,renderFileOperation:m,renderFileItem:y,renderThumbnail:v,disabled:L,onPreviewClick:E,picWidth:_,picHeight:b}=this.props,I=Object.assign(Object.assign(Object.assign({},o(this.props,["showRetry","showReplace",""])),t),{previewFile:d,listType:p,onRemove:()=>this.remove(t),onRetry:()=>{this.foundation.retry(t)},index:i,key:c||`${s}${i}`,style:h,disabled:L,showPicInfo:u,renderPicInfo:f,renderPicPreviewIcon:g,renderFileOperation:m,renderThumbnail:v,onReplace:()=>{this.replace(i)},onPreviewClick:void 0!==E?()=>this.foundation.handlePreviewClick(t):void 0,picWidth:_,picHeight:b});return r!==z.FILE_STATUS_UPLOAD_FAIL||n||(I.validateMessage=a.fail),l&&!n&&(I.validateMessage=a.illegalSize),void 0===y?e.createElement(oe,Object.assign({},I)):y(I)},this.renderFileList=()=>{const{listType:e}=this.props;return e===z.FILE_LIST_PIC?this.renderFileListPic():e===z.FILE_LIST_DEFAULT?this.renderFileListDefault():null},this.renderFileListPic=()=>{const{showUploadList:t,limit:i,disabled:a,children:s,draggable:r,hotSpotLocation:n,picHeight:l,picWidth:o}=this.props,{fileList:c,dragAreaStatus:p}=this.state,h=this.props.fileList||c,u=!i||i>h.length,f=`${ce}-drag-area`,g=S(`${ce}-add`,{[`${ce}-picture-add`]:!0,[`${ce}-picture-add-disabled`]:a}),m=S(`${ce}-file-list`,{[`${ce}-picture-file-list`]:!0}),y=S({[`${f}-legal`]:p===z.DRAG_AREA_LEGAL,[`${f}-illegal`]:p===z.DRAG_AREA_ILLEGAL}),v=`${ce}-file-list-main`,L={role:"button",className:g,onClick:this.onClick,style:{height:l,width:o}},E={className:m},_={onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnter:this.onDragEnter};r&&Object.assign(L,_,{className:S(g,y)});const b=e.createElement("div",Object.assign({},L,{"x-semi-prop":"children"}),s);return t&&h.length?e.createElement(d,{componentName:"Upload"},(t=>e.createElement("div",Object.assign({},E),e.createElement("div",{className:v,role:"list","aria-label":"picture list"},u&&"start"===n?b:null,h.map(((e,i)=>this.renderFile(e,i,t))),u&&"end"===n?b:null)))):u?b:null},this.renderFileListDefault=()=>{const{showUploadList:t,limit:i,disabled:a}=this.props,{fileList:s}=this.state,r=this.props.fileList||s,n=S(`${ce}-file-list`),l=`${ce}-file-list-title`,o=`${ce}-file-list-main`,c=1!==i&&r.length,p=this.props.showClear&&!a,h={className:n};return t&&r.length?e.createElement(d,{componentName:"Upload"},(t=>e.createElement("div",Object.assign({},h),c?e.createElement("div",{className:l},e.createElement("span",{className:`${l}-choosen`},t.selectedFiles),p?e.createElement("span",{role:"button",tabIndex:0,onClick:this.clear,className:`${l}-clear`},t.clear):null):null,e.createElement("div",{className:o,role:"list","aria-label":"file list"},r.map(((e,i)=>this.renderFile(e,i,t))))))):null},this.onDrop=e=>{this.foundation.handleDrop(e)},this.onDragOver=e=>{this.foundation.handleDragOver(e)},this.onDragLeave=e=>{this.foundation.handleDragLeave(e)},this.onDragEnter=e=>{this.foundation.handleDragEnter(e)},this.renderAddContent=()=>{const{draggable:t,children:i,listType:a,disabled:s}=this.props,r=S(`${ce}-add`);return a===z.FILE_LIST_PIC?null:t?this.renderDragArea():e.createElement("div",{role:"button",tabIndex:0,"aria-disabled":s,className:r,onClick:this.onClick},i)},this.renderDragArea=()=>{const{dragAreaStatus:t}=this.state,{children:i,dragIcon:a,dragMainText:s,dragSubText:r,disabled:n}=this.props,l=`${ce}-drag-area`,o=S(l,{[`${l}-legal`]:t===z.DRAG_AREA_LEGAL,[`${l}-illegal`]:t===z.DRAG_AREA_ILLEGAL,[`${l}-custom`]:i});return e.createElement(d,{componentName:"Upload"},(c=>e.createElement("div",{role:"button",tabIndex:0,"aria-disabled":n,className:o,onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDragEnter:this.onDragEnter,onClick:this.onClick},i||e.createElement(e.Fragment,null,e.createElement("div",{className:`${l}-icon`,"x-semi-prop":"dragIcon"},a||e.createElement(D,{size:"extra-large"})),e.createElement("div",{className:`${l}-text`},e.createElement("div",{className:`${l}-main-text`,"x-semi-prop":"dragMainText"},s||c.mainText),e.createElement("div",{className:`${l}-sub-text`,"x-semi-prop":"dragSubText"},r),e.createElement("div",{className:`${l}-tips`},t===z.DRAG_AREA_LEGAL&&e.createElement("span",{className:`${l}-tips-legal`},c.legalTips),t===z.DRAG_AREA_ILLEGAL&&e.createElement("span",{className:`${l}-tips-illegal`},c.illegalTips)))))))},this.state={fileList:t.defaultFileList||[],replaceIdx:-1,inputKey:Math.random(),replaceInputKey:Math.random(),dragAreaStatus:"default",localUrls:[]},this.foundation=new ie(this.adapter),this.inputRef=e.createRef(),this.replaceInputRef=e.createRef()}static getDerivedStateFromProps(e){const{fileList:t}=e;return"fileList"in e?{fileList:t||[]}:null}get adapter(){return Object.assign(Object.assign({},super.adapter),{notifyFileSelect:e=>this.props.onFileChange(e),notifyError:(e,t,i,a)=>this.props.onError(e,t,i,a),notifySuccess:(e,t,i)=>this.props.onSuccess(e,t,i),notifyProgress:(e,t,i)=>this.props.onProgress(e,t,i),notifyRemove:(e,t,i)=>this.props.onRemove(e,t,i),notifySizeError:(e,t)=>this.props.onSizeError(e,t),notifyExceed:e=>this.props.onExceed(e),updateFileList:(e,t)=>{"function"==typeof t?this.setState({fileList:e},t):this.setState({fileList:e})},notifyBeforeUpload:e=>{let{file:t,fileList:i}=e;return this.props.beforeUpload({file:t,fileList:i})},notifyAfterUpload:e=>{let{response:t,file:i,fileList:a}=e;return this.props.afterUpload({response:t,file:i,fileList:a})},resetInput:()=>{this.setState((e=>({inputKey:Math.random()})))},resetReplaceInput:()=>{this.setState((e=>({replaceInputKey:Math.random()})))},isMac:()=>navigator.platform.toUpperCase().indexOf("MAC")>=0,registerPastingHandler:e=>{document.body.addEventListener("keydown",e),this.pastingCb=e},unRegisterPastingHandler:()=>{this.pastingCb&&document.body.removeEventListener("keydown",this.pastingCb)},notifyPastingError:e=>this.props.onPastingError(e),updateDragAreaStatus:e=>this.setState({dragAreaStatus:e}),notifyChange:e=>{let{currentFile:t,fileList:i}=e;return this.props.onChange({currentFile:t,fileList:i})},updateLocalUrls:e=>this.setState({localUrls:e}),notifyClear:()=>this.props.onClear(),notifyPreviewClick:e=>this.props.onPreviewClick(e),notifyDrop:(e,t,i)=>this.props.onDrop(e,t,i),notifyAcceptInvalid:e=>this.props.onAcceptInvalid(e),notifyBeforeRemove:(e,t)=>this.props.beforeRemove(e,t),notifyBeforeClear:e=>this.props.beforeClear(e)})}componentDidMount(){this.foundation.init()}componentWillUnmount(){this.foundation.destroy()}render(){const t=this.props,{style:i,className:a,multiple:s,accept:r,disabled:n,children:l,capture:o,listType:c,prompt:d,promptPosition:p,draggable:h,validateMessage:u,validateStatus:f,directory:g}=t,m=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i}(t,["style","className","multiple","accept","disabled","children","capture","listType","prompt","promptPosition","draggable","validateMessage","validateStatus","directory"]),y=S(ce,{[`${ce}-picture`]:c===z.FILE_LIST_PIC,[`${ce}-disabled`]:n,[`${ce}-default`]:"default"===f,[`${ce}-error`]:"error"===f,[`${ce}-warning`]:"warning"===f,[`${ce}-success`]:"success"===f},a),v=S(`${ce}-hidden-input`),L=S(`${ce}-hidden-input-replace`),E=S(`${ce}-prompt`),_=S(`${ce}-validate-message`),b=g?{directory:"directory",webkitdirectory:"webkitdirectory"}:{};return e.createElement("div",Object.assign({className:y,style:i,"x-prompt-pos":p},this.getDataAttr(m)),e.createElement("input",Object.assign({key:this.state.inputKey,capture:o,multiple:s,accept:r,onChange:this.onChange,type:"file",autoComplete:"off",tabIndex:-1,className:v,ref:this.inputRef},b)),e.createElement("input",{key:this.state.replaceInputKey,multiple:!1,accept:r,onChange:this.onReplaceChange,type:"file",autoComplete:"off",tabIndex:-1,className:L,ref:this.replaceInputRef}),this.renderAddContent(),d?e.createElement("div",{className:E,"x-semi-prop":"prompt"},d):null,u?e.createElement("div",{className:_,"x-semi-prop":"validateMessage"},u):null,this.renderFileList())}}de.propTypes={accept:i.string,action:i.string.isRequired,addOnPasting:i.bool,afterUpload:i.func,beforeClear:i.func,beforeRemove:i.func,beforeUpload:i.func,children:i.node,className:i.string,customRequest:i.func,data:i.oneOfType([i.object,i.func]),defaultFileList:i.array,directory:i.bool,disabled:i.bool,dragIcon:i.node,dragMainText:i.node,dragSubText:i.node,draggable:i.bool,fileList:i.array,fileName:i.string,headers:i.oneOfType([i.object,i.func]),hotSpotLocation:i.oneOf(["start","end"]),itemStyle:i.object,limit:i.number,listType:i.oneOf(z.LIST_TYPE),maxSize:i.number,minSize:i.number,multiple:i.bool,name:i.string,onAcceptInvalid:i.func,onChange:i.func,onClear:i.func,onDrop:i.func,onError:i.func,onExceed:i.func,onFileChange:i.func,onOpenFileDialog:i.func,onPreviewClick:i.func,onProgress:i.func,onRemove:i.func,onRetry:i.func,onSizeError:i.func,onSuccess:i.func,onPastingError:i.func,previewFile:i.func,prompt:i.node,promptPosition:i.oneOf(z.PROMPT_POSITION),picWidth:i.oneOfType([i.number,i.string]),picHeight:i.oneOfType([i.number,i.string]),renderFileItem:i.func,renderPicPreviewIcon:i.func,renderFileOperation:i.func,renderPicInfo:i.func,renderThumbnail:i.func,showClear:i.bool,showPicInfo:i.bool,showReplace:i.bool,showRetry:i.bool,showUploadList:i.bool,style:i.object,timeout:i.number,transformFile:i.func,uploadTrigger:i.oneOf(z.UPLOAD_TRIGGER),validateMessage:i.node,validateStatus:i.oneOf(z.VALIDATE_STATUS),withCredentials:i.bool},de.defaultProps={defaultFileList:[],disabled:!1,listType:"list",hotSpotLocation:"end",multiple:!1,onAcceptInvalid:A,onChange:A,beforeRemove:()=>!0,beforeClear:()=>!0,onClear:A,onDrop:A,onError:A,onExceed:A,onFileChange:A,onOpenFileDialog:A,onProgress:A,onRemove:A,onRetry:A,onSizeError:A,onSuccess:A,onPastingError:A,promptPosition:"right",showClear:!0,showPicInfo:!1,showReplace:!1,showRetry:!0,showUploadList:!0,uploadTrigger:"auto",withCredentials:!1},de.FileCard=oe;const{Title:pe}=u;function he(){const{t:e}=P(),[i,o]=t.useState(!0),[c,d]=t.useState([]),[u,g]=t.useState(!1),m=`${a()}${w("upload")}?uuid=${s("uuid")}`,v=`${a()}${w("clear")}`,L=e=>g(e),E=e=>o(e);function _(t){T(e("New_Notify_Send"),t)}return r.jsx("div",{style:{padding:"24px",maxWidth:"800px",margin:"0 auto"},children:r.jsx(p,{title:r.jsx(pe,{heading:3,children:e("Image_OCR_Tool")}),style:{borderRadius:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:r.jsxs(h,{vertical:!0,align:"center",spacing:"loose",style:{width:"100%"},children:[r.jsx(de,{action:m,listType:"picture",accept:".png,.jpeg,.jpg",enctype:"multipart/form-data",limit:1,onError:()=>E(!0),onSuccess:()=>E(!1),onClear:()=>{fetch(`${v}?filename=${s("uuid")}`).then(),E(!0),d([])},onRemove:()=>{fetch(`${v}?filename=${s("uuid")}`).then(),E(!0),d([])},children:r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx(O,{size:"extra-large",style:{color:"#666"}}),r.jsx("p",{style:{margin:"8px 0 0",color:"#666"},children:e("Click_or_Drag_to_Upload")})]})}),r.jsx(y,{delay:100,spinning:u,children:r.jsx(l,{theme:"solid",type:"primary",size:"large",onClick:async function(){L(!0);try{const t=await fetch(`${a()}${w("start")}?uuid=${s("uuid")}`);!function(t){let i=[];""===t[0]?(i=[{key:e("Failed_OCR"),value:t[0]}],_(`${e("Failed_OCR")}${t[0]}`)):(i=[{key:e("Success_OCR_Text"),value:t[0]}],_(`${e("Success_OCR_Text")}${t[0]}`));d(i),L(!1)}(await t.json())}catch(t){n("Fetch Error","error",t),L(!1)}},disabled:i,style:{marginTop:"16px",padding:"0 32px",borderRadius:"8px"},children:e("Start_OCR")})}),c.length>0&&r.jsx(f,{data:c,style:{width:"100%",background:"#f5f5f5",padding:"16px",borderRadius:"8px",marginTop:"16px"},row:!0})]})})})}export{he as default};
